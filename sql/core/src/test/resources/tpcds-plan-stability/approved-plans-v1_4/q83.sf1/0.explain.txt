== Parsed Logical Plan ==
CTE [sr_items, cr_items, wr_items]
:  :- 'SubqueryAlias sr_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#1, 'sum('sr_return_quantity) AS sr_item_qty#2]
:  :     +- 'Filter ((('sr_item_sk = 'i_item_sk) AND 'd_date IN (list#3 [])) AND ('sr_returned_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter 'd_week_seq IN (list#4 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter 'd_date IN (2000-06-30,2000-09-27,2000-11-17)
:  :        :        :        +- 'UnresolvedRelation [date_dim]
:  :        :        +- 'UnresolvedRelation [date_dim]
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [store_returns]
:  :           :  +- 'UnresolvedRelation [item]
:  :           +- 'UnresolvedRelation [date_dim]
:  :- 'SubqueryAlias cr_items
:  :  +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#5, 'sum('cr_return_quantity) AS cr_item_qty#6]
:  :     +- 'Filter ((('cr_item_sk = 'i_item_sk) AND 'd_date IN (list#7 [])) AND ('cr_returned_date_sk = 'd_date_sk))
:  :        :  +- 'Project ['d_date]
:  :        :     +- 'Filter 'd_week_seq IN (list#8 [])
:  :        :        :  +- 'Project ['d_week_seq]
:  :        :        :     +- 'Filter 'd_date IN (2000-06-30,2000-09-27,2000-11-17)
:  :        :        :        +- 'UnresolvedRelation [date_dim]
:  :        :        +- 'UnresolvedRelation [date_dim]
:  :        +- 'Join Inner
:  :           :- 'Join Inner
:  :           :  :- 'UnresolvedRelation [catalog_returns]
:  :           :  +- 'UnresolvedRelation [item]
:  :           +- 'UnresolvedRelation [date_dim]
:  +- 'SubqueryAlias wr_items
:     +- 'Aggregate ['i_item_id], ['i_item_id AS item_id#9, 'sum('wr_return_quantity) AS wr_item_qty#10]
:        +- 'Filter ((('wr_item_sk = 'i_item_sk) AND 'd_date IN (list#11 [])) AND ('wr_returned_date_sk = 'd_date_sk))
:           :  +- 'Project ['d_date]
:           :     +- 'Filter 'd_week_seq IN (list#12 [])
:           :        :  +- 'Project ['d_week_seq]
:           :        :     +- 'Filter 'd_date IN (2000-06-30,2000-09-27,2000-11-17)
:           :        :        +- 'UnresolvedRelation [date_dim]
:           :        +- 'UnresolvedRelation [date_dim]
:           +- 'Join Inner
:              :- 'Join Inner
:              :  :- 'UnresolvedRelation [web_returns]
:              :  +- 'UnresolvedRelation [item]
:              +- 'UnresolvedRelation [date_dim]
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Sort ['sr_items.item_id ASC NULLS FIRST, 'sr_item_qty ASC NULLS FIRST], true
         +- 'Project ['sr_items.item_id, 'sr_item_qty, ((('sr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS sr_dev#13, 'cr_item_qty, ((('cr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS cr_dev#14, 'wr_item_qty, ((('wr_item_qty / (('sr_item_qty + 'cr_item_qty) + 'wr_item_qty)) / 3.0) * 100) AS wr_dev#15, ((('sr_item_qty + 'cr_item_qty) + 'wr_item_qty) / 3.0) AS average#16]
            +- 'Filter (('sr_items.item_id = 'cr_items.item_id) AND ('sr_items.item_id = 'wr_items.item_id))
               +- 'Join Inner
                  :- 'Join Inner
                  :  :- 'UnresolvedRelation [sr_items]
                  :  +- 'UnresolvedRelation [cr_items]
                  +- 'UnresolvedRelation [wr_items]

== Analyzed Logical Plan ==
item_id: string, sr_item_qty: bigint, sr_dev: double, cr_item_qty: bigint, cr_dev: double, wr_item_qty: bigint, wr_dev: double, average: decimal(27,6)
GlobalLimit 100
+- LocalLimit 100
   +- Sort [item_id#1 ASC NULLS FIRST, sr_item_qty#17 ASC NULLS FIRST], true
      +- Project [item_id#1, sr_item_qty#17, (((cast(sr_item_qty#17 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / cast(3.0 as double)) * cast(100 as double)) AS sr_dev#13, cr_item_qty#18, (((cast(cr_item_qty#18 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / cast(3.0 as double)) * cast(100 as double)) AS cr_dev#14, wr_item_qty#19, (((cast(wr_item_qty#19 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / cast(3.0 as double)) * cast(100 as double)) AS wr_dev#15, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as decimal(20,0)) as decimal(21,1))) / promote_precision(cast(3.0 as decimal(21,1)))), DecimalType(27,6), true) AS average#16]
         +- Filter ((item_id#1 = item_id#5) AND (item_id#1 = item_id#9))
            +- Join Inner
               :- Join Inner
               :  :- SubqueryAlias sr_items
               :  :  +- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#1, sum(cast(sr_return_quantity#21 as bigint)) AS sr_item_qty#17]
               :  :     +- Filter (((sr_item_sk#22 = cast(i_item_sk#23 as bigint)) AND d_date#24 IN (list#3 [])) AND (sr_returned_date_sk#25 = cast(d_date_sk#26 as bigint)))
               :  :        :  +- Project [d_date#24]
               :  :        :     +- Filter d_week_seq#27 IN (list#4 [])
               :  :        :        :  +- Project [d_week_seq#27]
               :  :        :        :     +- Filter cast(d_date#24 as string) IN (cast(2000-06-30 as string),cast(2000-09-27 as string),cast(2000-11-17 as string))
               :  :        :        :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :  :        :        :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               :  :        :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :  :        :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               :  :        +- Join Inner
               :  :           :- Join Inner
               :  :           :  :- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.store_returns
               :  :           :  :  +- Relation[sr_returned_date_sk#25,sr_return_time_sk#49,sr_item_sk#22,sr_customer_sk#50,sr_cdemo_sk#51,sr_hdemo_sk#52,sr_addr_sk#53,sr_store_sk#54,sr_reason_sk#55,sr_ticket_number#56,sr_return_quantity#21,sr_return_amt#57,sr_return_tax#58,sr_return_amt_inc_tax#59,sr_fee#60,sr_return_ship_cost#61,sr_refunded_cash#62,sr_reversed_charge#63,sr_store_credit#64,sr_net_loss#65] parquet
               :  :           :  +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.item
               :  :           :     +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
               :  :           +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :  :              +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               :  +- SubqueryAlias cr_items
               :     +- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#5, sum(cast(cr_return_quantity#86 as bigint)) AS cr_item_qty#18]
               :        +- Filter (((cr_item_sk#87 = i_item_sk#23) AND d_date#24 IN (list#7 [])) AND (cr_returned_date_sk#88 = d_date_sk#26))
               :           :  +- Project [d_date#24]
               :           :     +- Filter d_week_seq#27 IN (list#8 [])
               :           :        :  +- Project [d_week_seq#27]
               :           :        :     +- Filter cast(d_date#24 as string) IN (cast(2000-06-30 as string),cast(2000-09-27 as string),cast(2000-11-17 as string))
               :           :        :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :           :        :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               :           :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :           :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               :           +- Join Inner
               :              :- Join Inner
               :              :  :- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.catalog_returns
               :              :  :  +- Relation[cr_returned_date_sk#88,cr_returned_time_sk#89,cr_item_sk#87,cr_refunded_customer_sk#90,cr_refunded_cdemo_sk#91,cr_refunded_hdemo_sk#92,cr_refunded_addr_sk#93,cr_returning_customer_sk#94,cr_returning_cdemo_sk#95,cr_returning_hdemo_sk#96,cr_returning_addr_sk#97,cr_call_center_sk#98,cr_catalog_page_sk#99,cr_ship_mode_sk#100,cr_warehouse_sk#101,cr_reason_sk#102,cr_order_number#103,cr_return_quantity#86,cr_return_amount#104,cr_return_tax#105,cr_return_amt_inc_tax#106,cr_fee#107,cr_return_ship_cost#108,cr_refunded_cash#109,... 3 more fields] parquet
               :              :  +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.item
               :              :     +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
               :              +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
               :                 +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
               +- SubqueryAlias wr_items
                  +- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#9, sum(cast(wr_return_quantity#110 as bigint)) AS wr_item_qty#19]
                     +- Filter (((wr_item_sk#111 = cast(i_item_sk#23 as bigint)) AND d_date#24 IN (list#11 [])) AND (wr_returned_date_sk#112 = cast(d_date_sk#26 as bigint)))
                        :  +- Project [d_date#24]
                        :     +- Filter d_week_seq#27 IN (list#12 [])
                        :        :  +- Project [d_week_seq#27]
                        :        :     +- Filter cast(d_date#24 as string) IN (cast(2000-06-30 as string),cast(2000-09-27 as string),cast(2000-11-17 as string))
                        :        :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
                        :        :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
                        :        +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
                        :           +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
                        +- Join Inner
                           :- Join Inner
                           :  :- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.web_returns
                           :  :  +- Relation[wr_returned_date_sk#112,wr_returned_time_sk#113,wr_item_sk#111,wr_refunded_customer_sk#114,wr_refunded_cdemo_sk#115,wr_refunded_hdemo_sk#116,wr_refunded_addr_sk#117,wr_returning_customer_sk#118,wr_returning_cdemo_sk#119,wr_returning_hdemo_sk#120,wr_returning_addr_sk#121,wr_web_page_sk#122,wr_reason_sk#123,wr_order_number#124,wr_return_quantity#110,wr_return_amt#125,wr_return_tax#126,wr_return_amt_inc_tax#127,wr_fee#128,wr_return_ship_cost#129,wr_refunded_cash#130,wr_reversed_charge#131,wr_account_credit#132,wr_net_loss#133] parquet
                           :  +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.item
                           :     +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
                           +- SubqueryAlias spark_catalog.tpcds_sf1_parquet_stats.date_dim
                              +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Sort [item_id#1 ASC NULLS FIRST, sr_item_qty#17 ASC NULLS FIRST], true
      +- Project [item_id#1, sr_item_qty#17, (((cast(sr_item_qty#17 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS sr_dev#13, cr_item_qty#18, (((cast(cr_item_qty#18 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS cr_dev#14, wr_item_qty#19, (((cast(wr_item_qty#19 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS wr_dev#15, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6), true) AS average#16]
         +- Join Inner, (item_id#1 = item_id#9)
            :- Project [item_id#1, sr_item_qty#17, cr_item_qty#18]
            :  +- Join Inner, (item_id#1 = item_id#5)
            :     :- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#1, sum(cast(sr_return_quantity#21 as bigint)) AS sr_item_qty#17]
            :     :  +- Project [sr_return_quantity#21, i_item_id#20]
            :     :     +- Join Inner, (sr_returned_date_sk#25 = cast(d_date_sk#26 as bigint))
            :     :        :- Project [sr_returned_date_sk#25, sr_return_quantity#21, i_item_id#20]
            :     :        :  +- Join Inner, (sr_item_sk#22 = cast(i_item_sk#23 as bigint))
            :     :        :     :- Project [sr_returned_date_sk#25, sr_item_sk#22, sr_return_quantity#21]
            :     :        :     :  +- Filter (isnotnull(sr_item_sk#22) AND isnotnull(sr_returned_date_sk#25))
            :     :        :     :     +- Relation[sr_returned_date_sk#25,sr_return_time_sk#49,sr_item_sk#22,sr_customer_sk#50,sr_cdemo_sk#51,sr_hdemo_sk#52,sr_addr_sk#53,sr_store_sk#54,sr_reason_sk#55,sr_ticket_number#56,sr_return_quantity#21,sr_return_amt#57,sr_return_tax#58,sr_return_amt_inc_tax#59,sr_fee#60,sr_return_ship_cost#61,sr_refunded_cash#62,sr_reversed_charge#63,sr_store_credit#64,sr_net_loss#65] parquet
            :     :        :     +- Project [i_item_sk#23, i_item_id#20]
            :     :        :        +- Filter (isnotnull(i_item_sk#23) AND isnotnull(i_item_id#20))
            :     :        :           +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
            :     :        +- Project [d_date_sk#26]
            :     :           +- Join LeftSemi, (d_date#24 = d_date#24#134)
            :     :              :- Project [d_date_sk#26, d_date#24]
            :     :              :  +- Filter isnotnull(d_date_sk#26)
            :     :              :     +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            :     :              +- Project [d_date#24 AS d_date#24#134]
            :     :                 +- Join LeftSemi, (d_week_seq#27 = d_week_seq#27#135)
            :     :                    :- Project [d_date#24, d_week_seq#27]
            :     :                    :  +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            :     :                    +- Project [d_week_seq#27 AS d_week_seq#27#135]
            :     :                       +- Filter cast(d_date#24 as string) IN (2000-06-30,2000-09-27,2000-11-17)
            :     :                          +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            :     +- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#5, sum(cast(cr_return_quantity#86 as bigint)) AS cr_item_qty#18]
            :        +- Project [cr_return_quantity#86, i_item_id#20]
            :           +- Join Inner, (cr_returned_date_sk#88 = d_date_sk#26)
            :              :- Project [cr_returned_date_sk#88, cr_return_quantity#86, i_item_id#20]
            :              :  +- Join Inner, (cr_item_sk#87 = i_item_sk#23)
            :              :     :- Project [cr_returned_date_sk#88, cr_item_sk#87, cr_return_quantity#86]
            :              :     :  +- Filter (isnotnull(cr_item_sk#87) AND isnotnull(cr_returned_date_sk#88))
            :              :     :     +- Relation[cr_returned_date_sk#88,cr_returned_time_sk#89,cr_item_sk#87,cr_refunded_customer_sk#90,cr_refunded_cdemo_sk#91,cr_refunded_hdemo_sk#92,cr_refunded_addr_sk#93,cr_returning_customer_sk#94,cr_returning_cdemo_sk#95,cr_returning_hdemo_sk#96,cr_returning_addr_sk#97,cr_call_center_sk#98,cr_catalog_page_sk#99,cr_ship_mode_sk#100,cr_warehouse_sk#101,cr_reason_sk#102,cr_order_number#103,cr_return_quantity#86,cr_return_amount#104,cr_return_tax#105,cr_return_amt_inc_tax#106,cr_fee#107,cr_return_ship_cost#108,cr_refunded_cash#109,... 3 more fields] parquet
            :              :     +- Project [i_item_sk#23, i_item_id#20]
            :              :        +- Filter (isnotnull(i_item_sk#23) AND isnotnull(i_item_id#20))
            :              :           +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
            :              +- Project [d_date_sk#26]
            :                 +- Join LeftSemi, (d_date#24 = d_date#24#136)
            :                    :- Project [d_date_sk#26, d_date#24]
            :                    :  +- Filter isnotnull(d_date_sk#26)
            :                    :     +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            :                    +- Project [d_date#24 AS d_date#24#136]
            :                       +- Join LeftSemi, (d_week_seq#27 = d_week_seq#27#137)
            :                          :- Project [d_date#24, d_week_seq#27]
            :                          :  +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            :                          +- Project [d_week_seq#27 AS d_week_seq#27#137]
            :                             +- Filter cast(d_date#24 as string) IN (2000-06-30,2000-09-27,2000-11-17)
            :                                +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
            +- Aggregate [i_item_id#20], [i_item_id#20 AS item_id#9, sum(cast(wr_return_quantity#110 as bigint)) AS wr_item_qty#19]
               +- Project [wr_return_quantity#110, i_item_id#20]
                  +- Join Inner, (wr_returned_date_sk#112 = cast(d_date_sk#26 as bigint))
                     :- Project [wr_returned_date_sk#112, wr_return_quantity#110, i_item_id#20]
                     :  +- Join Inner, (wr_item_sk#111 = cast(i_item_sk#23 as bigint))
                     :     :- Project [wr_returned_date_sk#112, wr_item_sk#111, wr_return_quantity#110]
                     :     :  +- Filter (isnotnull(wr_item_sk#111) AND isnotnull(wr_returned_date_sk#112))
                     :     :     +- Relation[wr_returned_date_sk#112,wr_returned_time_sk#113,wr_item_sk#111,wr_refunded_customer_sk#114,wr_refunded_cdemo_sk#115,wr_refunded_hdemo_sk#116,wr_refunded_addr_sk#117,wr_returning_customer_sk#118,wr_returning_cdemo_sk#119,wr_returning_hdemo_sk#120,wr_returning_addr_sk#121,wr_web_page_sk#122,wr_reason_sk#123,wr_order_number#124,wr_return_quantity#110,wr_return_amt#125,wr_return_tax#126,wr_return_amt_inc_tax#127,wr_fee#128,wr_return_ship_cost#129,wr_refunded_cash#130,wr_reversed_charge#131,wr_account_credit#132,wr_net_loss#133] parquet
                     :     +- Project [i_item_sk#23, i_item_id#20]
                     :        +- Filter (isnotnull(i_item_sk#23) AND isnotnull(i_item_id#20))
                     :           +- Relation[i_item_sk#23,i_item_id#20,i_rec_start_date#66,i_rec_end_date#67,i_item_desc#68,i_current_price#69,i_wholesale_cost#70,i_brand_id#71,i_brand#72,i_class_id#73,i_class#74,i_category_id#75,i_category#76,i_manufact_id#77,i_manufact#78,i_size#79,i_formulation#80,i_color#81,i_units#82,i_container#83,i_manager_id#84,i_product_name#85] parquet
                     +- Project [d_date_sk#26]
                        +- Join LeftSemi, (d_date#24 = d_date#24#138)
                           :- Project [d_date_sk#26, d_date#24]
                           :  +- Filter isnotnull(d_date_sk#26)
                           :     +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
                           +- Project [d_date#24 AS d_date#24#138]
                              +- Join LeftSemi, (d_week_seq#27 = d_week_seq#27#139)
                                 :- Project [d_date#24, d_week_seq#27]
                                 :  +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet
                                 +- Project [d_week_seq#27 AS d_week_seq#27#139]
                                    +- Filter cast(d_date#24 as string) IN (2000-06-30,2000-09-27,2000-11-17)
                                       +- Relation[d_date_sk#26,d_date_id#28,d_date#24,d_month_seq#29,d_week_seq#27,d_quarter_seq#30,d_year#31,d_dow#32,d_moy#33,d_dom#34,d_qoy#35,d_fy_year#36,d_fy_quarter_seq#37,d_fy_week_seq#38,d_day_name#39,d_quarter_name#40,d_holiday#41,d_weekend#42,d_following_holiday#43,d_first_dom#44,d_last_dom#45,d_same_day_ly#46,d_same_day_lq#47,d_current_day#48,... 4 more fields] parquet

== Physical Plan ==
TakeOrderedAndProject(limit=100, orderBy=[item_id#1 ASC NULLS FIRST,sr_item_qty#17 ASC NULLS FIRST], output=[item_id#1,sr_item_qty#17,sr_dev#13,cr_item_qty#18,cr_dev#14,wr_item_qty#19,wr_dev#15,average#16])
+- *(20) Project [item_id#1, sr_item_qty#17, (((cast(sr_item_qty#17 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS sr_dev#13, cr_item_qty#18, (((cast(cr_item_qty#18 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS cr_dev#14, wr_item_qty#19, (((cast(wr_item_qty#19 as double) / cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as double)) / 3.0) * 100.0) AS wr_dev#15, CheckOverflow((promote_precision(cast(cast(((sr_item_qty#17 + cr_item_qty#18) + wr_item_qty#19) as decimal(20,0)) as decimal(21,1))) / 3.0), DecimalType(27,6), true) AS average#16]
   +- *(20) SortMergeJoin [item_id#1], [item_id#9], Inner
      :- *(13) Project [item_id#1, sr_item_qty#17, cr_item_qty#18]
      :  +- *(13) SortMergeJoin [item_id#1], [item_id#5], Inner
      :     :- *(6) Sort [item_id#1 ASC NULLS FIRST], false, 0
      :     :  +- *(6) HashAggregate(keys=[i_item_id#20], functions=[sum(cast(sr_return_quantity#21 as bigint))], output=[item_id#1, sr_item_qty#17])
      :     :     +- Exchange hashpartitioning(i_item_id#20, 5), true, [id=#140]
      :     :        +- *(5) HashAggregate(keys=[i_item_id#20], functions=[partial_sum(cast(sr_return_quantity#21 as bigint))], output=[i_item_id#20, sum#141])
      :     :           +- *(5) Project [sr_return_quantity#21, i_item_id#20]
      :     :              +- *(5) BroadcastHashJoin [sr_returned_date_sk#25], [cast(d_date_sk#26 as bigint)], Inner, BuildRight, false
      :     :                 :- *(5) Project [sr_returned_date_sk#25, sr_return_quantity#21, i_item_id#20]
      :     :                 :  +- *(5) BroadcastHashJoin [sr_item_sk#22], [cast(i_item_sk#23 as bigint)], Inner, BuildRight, false
      :     :                 :     :- *(5) Project [sr_returned_date_sk#25, sr_item_sk#22, sr_return_quantity#21]
      :     :                 :     :  +- *(5) Filter (isnotnull(sr_item_sk#22) AND isnotnull(sr_returned_date_sk#25))
      :     :                 :     :     +- *(5) ColumnarToRow
      :     :                 :     :        +- FileScan parquet tpcds_sf1_parquet_stats.store_returns[sr_returned_date_sk#25,sr_item_sk#22,sr_return_quantity#21] Batched: true, DataFilters: [isnotnull(sr_item_sk#22), isnotnull(sr_returned_date_sk#25)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(sr_item_sk), IsNotNull(sr_returned_date_sk)], ReadSchema: struct<sr_returned_date_sk:bigint,sr_item_sk:bigint,sr_return_quantity:int>
      :     :                 :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#142]
      :     :                 :        +- *(1) Project [i_item_sk#23, i_item_id#20]
      :     :                 :           +- *(1) Filter (isnotnull(i_item_sk#23) AND isnotnull(i_item_id#20))
      :     :                 :              +- *(1) ColumnarToRow
      :     :                 :                 +- FileScan parquet tpcds_sf1_parquet_stats.item[i_item_sk#23,i_item_id#20] Batched: true, DataFilters: [isnotnull(i_item_sk#23), isnotnull(i_item_id#20)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk), IsNotNull(i_item_id)], ReadSchema: struct<i_item_sk:int,i_item_id:string>
      :     :                 +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#143]
      :     :                    +- *(4) Project [d_date_sk#26]
      :     :                       +- *(4) BroadcastHashJoin [d_date#24], [d_date#24#134], LeftSemi, BuildRight, false
      :     :                          :- *(4) Project [d_date_sk#26, d_date#24]
      :     :                          :  +- *(4) Filter isnotnull(d_date_sk#26)
      :     :                          :     +- *(4) ColumnarToRow
      :     :                          :        +- FileScan parquet tpcds_sf1_parquet_stats.date_dim[d_date_sk#26,d_date#24] Batched: true, DataFilters: [isnotnull(d_date_sk#26)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date>
      :     :                          +- BroadcastExchange HashedRelationBroadcastMode(List(input[0, date, true]),false), [id=#144]
      :     :                             +- *(3) Project [d_date#24 AS d_date#24#134]
      :     :                                +- *(3) BroadcastHashJoin [d_week_seq#27], [d_week_seq#27#135], LeftSemi, BuildRight, false
      :     :                                   :- *(3) ColumnarToRow
      :     :                                   :  +- FileScan parquet tpcds_sf1_parquet_stats.date_dim[d_date#24,d_week_seq#27] Batched: true, DataFilters: [], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
      :     :                                   +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#145]
      :     :                                      +- *(2) Project [d_week_seq#27 AS d_week_seq#27#135]
      :     :                                         +- *(2) Filter cast(d_date#24 as string) IN (2000-06-30,2000-09-27,2000-11-17)
      :     :                                            +- *(2) ColumnarToRow
      :     :                                               +- FileScan parquet tpcds_sf1_parquet_stats.date_dim[d_date#24,d_week_seq#27] Batched: true, DataFilters: [cast(d_date#24 as string) IN (2000-06-30,2000-09-27,2000-11-17)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<d_date:date,d_week_seq:int>
      :     +- *(12) Sort [item_id#5 ASC NULLS FIRST], false, 0
      :        +- *(12) HashAggregate(keys=[i_item_id#20], functions=[sum(cast(cr_return_quantity#86 as bigint))], output=[item_id#5, cr_item_qty#18])
      :           +- Exchange hashpartitioning(i_item_id#20, 5), true, [id=#146]
      :              +- *(11) HashAggregate(keys=[i_item_id#20], functions=[partial_sum(cast(cr_return_quantity#86 as bigint))], output=[i_item_id#20, sum#147])
      :                 +- *(11) Project [cr_return_quantity#86, i_item_id#20]
      :                    +- *(11) BroadcastHashJoin [cr_returned_date_sk#88], [d_date_sk#26], Inner, BuildRight, false
      :                       :- *(11) Project [cr_returned_date_sk#88, cr_return_quantity#86, i_item_id#20]
      :                       :  +- *(11) BroadcastHashJoin [cr_item_sk#87], [i_item_sk#23], Inner, BuildRight, false
      :                       :     :- *(11) Project [cr_returned_date_sk#88, cr_item_sk#87, cr_return_quantity#86]
      :                       :     :  +- *(11) Filter (isnotnull(cr_item_sk#87) AND isnotnull(cr_returned_date_sk#88))
      :                       :     :     +- *(11) ColumnarToRow
      :                       :     :        +- FileScan parquet tpcds_sf1_parquet_stats.catalog_returns[cr_returned_date_sk#88,cr_item_sk#87,cr_return_quantity#86] Batched: true, DataFilters: [isnotnull(cr_item_sk#87), isnotnull(cr_returned_date_sk#88)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(cr_item_sk), IsNotNull(cr_returned_date_sk)], ReadSchema: struct<cr_returned_date_sk:int,cr_item_sk:int,cr_return_quantity:int>
      :                       :     +- ReusedExchange [i_item_sk#23, i_item_id#20], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#142]
      :                       +- ReusedExchange [d_date_sk#26], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#143]
      +- *(19) Sort [item_id#9 ASC NULLS FIRST], false, 0
         +- *(19) HashAggregate(keys=[i_item_id#20], functions=[sum(cast(wr_return_quantity#110 as bigint))], output=[item_id#9, wr_item_qty#19])
            +- Exchange hashpartitioning(i_item_id#20, 5), true, [id=#148]
               +- *(18) HashAggregate(keys=[i_item_id#20], functions=[partial_sum(cast(wr_return_quantity#110 as bigint))], output=[i_item_id#20, sum#149])
                  +- *(18) Project [wr_return_quantity#110, i_item_id#20]
                     +- *(18) BroadcastHashJoin [wr_returned_date_sk#112], [cast(d_date_sk#26 as bigint)], Inner, BuildRight, false
                        :- *(18) Project [wr_returned_date_sk#112, wr_return_quantity#110, i_item_id#20]
                        :  +- *(18) BroadcastHashJoin [wr_item_sk#111], [cast(i_item_sk#23 as bigint)], Inner, BuildRight, false
                        :     :- *(18) Project [wr_returned_date_sk#112, wr_item_sk#111, wr_return_quantity#110]
                        :     :  +- *(18) Filter (isnotnull(wr_item_sk#111) AND isnotnull(wr_returned_date_sk#112))
                        :     :     +- *(18) ColumnarToRow
                        :     :        +- FileScan parquet tpcds_sf1_parquet_stats.web_returns[wr_returned_date_sk#112,wr_item_sk#111,wr_return_quantity#110] Batched: true, DataFilters: [isnotnull(wr_item_sk#111), isnotnull(wr_returned_date_sk#112)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(wr_item_sk), IsNotNull(wr_returned_date_sk)], ReadSchema: struct<wr_returned_date_sk:bigint,wr_item_sk:bigint,wr_return_quantity:int>
                        :     +- ReusedExchange [i_item_sk#23, i_item_id#20], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#142]
                        +- ReusedExchange [d_date_sk#26], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#143]
