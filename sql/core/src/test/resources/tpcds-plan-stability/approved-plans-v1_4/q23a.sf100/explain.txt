== Parsed Logical Plan ==
CTE [frequent_ss_items, max_store_sales, best_ss_customer]
:  :- 'SubqueryAlias frequent_ss_items
:  :  +- 'UnresolvedHaving ('count(1) > 4)
:  :     +- 'Aggregate ['substr('i_item_desc, 1, 30), 'i_item_sk, 'd_date], ['substr('i_item_desc, 1, 30) AS itemdesc#1, 'i_item_sk AS item_sk#2, 'd_date AS solddate#3, 'count(1) AS cnt#4]
:  :        +- 'Filter ((('ss_sold_date_sk = 'd_date_sk) AND ('ss_item_sk = 'i_item_sk)) AND 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
:  :           +- 'Join Inner
:  :              :- 'Join Inner
:  :              :  :- 'UnresolvedRelation [store_sales]
:  :              :  +- 'UnresolvedRelation [date_dim]
:  :              +- 'UnresolvedRelation [item]
:  :- 'SubqueryAlias max_store_sales
:  :  +- 'Project ['max('csales) AS tpcds_cmax#5]
:  :     +- 'SubqueryAlias x
:  :        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS csales#6]
:  :           +- 'Filter ((('ss_customer_sk = 'c_customer_sk) AND ('ss_sold_date_sk = 'd_date_sk)) AND 'd_year IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
:  :              +- 'Join Inner
:  :                 :- 'Join Inner
:  :                 :  :- 'UnresolvedRelation [store_sales]
:  :                 :  +- 'UnresolvedRelation [customer]
:  :                 +- 'UnresolvedRelation [date_dim]
:  +- 'SubqueryAlias best_ss_customer
:     +- 'UnresolvedHaving ('sum(('ss_quantity * 'ss_sales_price)) > ((50 / 100.0) * scalar-subquery#7 []))
:        :  +- 'Project [*]
:        :     +- 'UnresolvedRelation [max_store_sales]
:        +- 'Aggregate ['c_customer_sk], ['c_customer_sk, 'sum(('ss_quantity * 'ss_sales_price)) AS ssales#8]
:           +- 'Filter ('ss_customer_sk = 'c_customer_sk)
:              +- 'Join Inner
:                 :- 'UnresolvedRelation [store_sales]
:                 +- 'UnresolvedRelation [customer]
+- 'GlobalLimit 100
   +- 'LocalLimit 100
      +- 'Project [unresolvedalias('sum('sales), None)]
         +- 'SubqueryAlias y
            +- 'Union false, false
               :- 'Project [('cs_quantity * 'cs_list_price) AS sales#9]
               :  +- 'Filter (((('d_year = 2000) AND ('d_moy = 2)) AND ('cs_sold_date_sk = 'd_date_sk)) AND ('cs_item_sk IN (list#10 []) AND 'cs_bill_customer_sk IN (list#11 [])))
               :     :  :- 'Project ['item_sk]
               :     :  :  +- 'UnresolvedRelation [frequent_ss_items]
               :     :  +- 'Project ['c_customer_sk]
               :     :     +- 'UnresolvedRelation [best_ss_customer]
               :     +- 'Join Inner
               :        :- 'UnresolvedRelation [catalog_sales]
               :        +- 'UnresolvedRelation [date_dim]
               +- 'Project [('ws_quantity * 'ws_list_price) AS sales#12]
                  +- 'Filter (((('d_year = 2000) AND ('d_moy = 2)) AND ('ws_sold_date_sk = 'd_date_sk)) AND ('ws_item_sk IN (list#13 []) AND 'ws_bill_customer_sk IN (list#14 [])))
                     :  :- 'Project ['item_sk]
                     :  :  +- 'UnresolvedRelation [frequent_ss_items]
                     :  +- 'Project ['c_customer_sk]
                     :     +- 'UnresolvedRelation [best_ss_customer]
                     +- 'Join Inner
                        :- 'UnresolvedRelation [web_sales]
                        +- 'UnresolvedRelation [date_dim]

== Analyzed Logical Plan ==
sum(sales): decimal(28,2)
GlobalLimit 100
+- LocalLimit 100
   +- Aggregate [sum(sales#9) AS sum(sales)#15]
      +- SubqueryAlias y
         +- Union false, false
            :- Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#16 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#17 as decimal(12,2)))), DecimalType(18,2), true) AS sales#9]
            :  +- Filter ((((d_year#18 = 2000) AND (d_moy#19 = 2)) AND (cs_sold_date_sk#20 = d_date_sk#21)) AND (cs_item_sk#22 IN (list#10 []) AND cs_bill_customer_sk#23 IN (list#11 [])))
            :     :  :- Project [item_sk#2]
            :     :  :  +- SubqueryAlias frequent_ss_items
            :     :  :     +- Project [itemdesc#1, item_sk#2, solddate#3, cnt#24]
            :     :  :        +- Filter (count(1)#25 > cast(4 as bigint))
            :     :  :           +- Aggregate [substr(i_item_desc#26, 1, 30), i_item_sk#27, d_date#28], [substr(i_item_desc#26, 1, 30) AS itemdesc#1, i_item_sk#27 AS item_sk#2, d_date#28 AS solddate#3, count(1) AS cnt#24, count(1) AS count(1)#25]
            :     :  :              +- Filter (((ss_sold_date_sk#29 = d_date_sk#21) AND (ss_item_sk#30 = i_item_sk#27)) AND d_year#18 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
            :     :  :                 +- Join Inner
            :     :  :                    :- Join Inner
            :     :  :                    :  :- SubqueryAlias spark_catalog.default.store_sales
            :     :  :                    :  :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
            :     :  :                    :  +- SubqueryAlias spark_catalog.default.date_dim
            :     :  :                    :     +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
            :     :  :                    +- SubqueryAlias spark_catalog.default.item
            :     :  :                       +- Relation[i_item_sk#27,i_item_id#72,i_rec_start_date#73,i_rec_end_date#74,i_item_desc#26,i_current_price#75,i_wholesale_cost#76,i_brand_id#77,i_brand#78,i_class_id#79,i_class#80,i_category_id#81,i_category#82,i_manufact_id#83,i_manufact#84,i_size#85,i_formulation#86,i_color#87,i_units#88,i_container#89,i_manager_id#90,i_product_name#91] parquet
            :     :  +- Project [c_customer_sk#92]
            :     :     +- SubqueryAlias best_ss_customer
            :     :        +- Project [c_customer_sk#92, ssales#8]
            :     :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(50 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6), true) as decimal(32,6))) * promote_precision(cast(scalar-subquery#7 [] as decimal(32,6)))), DecimalType(38,8), true) as decimal(38,8)))
            :     :              :  +- Project [tpcds_cmax#5]
            :     :              :     +- SubqueryAlias max_store_sales
            :     :              :        +- Aggregate [max(csales#6) AS tpcds_cmax#5]
            :     :              :           +- SubqueryAlias x
            :     :              :              +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS csales#6]
            :     :              :                 +- Filter (((ss_customer_sk#32 = c_customer_sk#92) AND (ss_sold_date_sk#29 = d_date_sk#21)) AND d_year#18 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
            :     :              :                    +- Join Inner
            :     :              :                       :- Join Inner
            :     :              :                       :  :- SubqueryAlias spark_catalog.default.store_sales
            :     :              :                       :  :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
            :     :              :                       :  +- SubqueryAlias spark_catalog.default.customer
            :     :              :                       :     +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
            :     :              :                       +- SubqueryAlias spark_catalog.default.date_dim
            :     :              :                          +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
            :     :              +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS ssales#8, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93]
            :     :                 +- Filter (ss_customer_sk#32 = c_customer_sk#92)
            :     :                    +- Join Inner
            :     :                       :- SubqueryAlias spark_catalog.default.store_sales
            :     :                       :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
            :     :                       +- SubqueryAlias spark_catalog.default.customer
            :     :                          +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
            :     +- Join Inner
            :        :- SubqueryAlias spark_catalog.default.catalog_sales
            :        :  +- Relation[cs_sold_date_sk#20,cs_sold_time_sk#111,cs_ship_date_sk#112,cs_bill_customer_sk#23,cs_bill_cdemo_sk#113,cs_bill_hdemo_sk#114,cs_bill_addr_sk#115,cs_ship_customer_sk#116,cs_ship_cdemo_sk#117,cs_ship_hdemo_sk#118,cs_ship_addr_sk#119,cs_call_center_sk#120,cs_catalog_page_sk#121,cs_ship_mode_sk#122,cs_warehouse_sk#123,cs_item_sk#22,cs_promo_sk#124,cs_order_number#125,cs_quantity#16,cs_wholesale_cost#126,cs_list_price#17,cs_sales_price#127,cs_ext_discount_amt#128,cs_ext_sales_price#129,... 10 more fields] parquet
            :        +- SubqueryAlias spark_catalog.default.date_dim
            :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
            +- Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#130 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#131 as decimal(12,2)))), DecimalType(18,2), true) AS sales#12]
               +- Filter ((((d_year#18 = 2000) AND (d_moy#19 = 2)) AND (ws_sold_date_sk#132 = d_date_sk#21)) AND (ws_item_sk#133 IN (list#13 []) AND ws_bill_customer_sk#134 IN (list#14 [])))
                  :  :- Project [item_sk#2]
                  :  :  +- SubqueryAlias frequent_ss_items
                  :  :     +- Project [itemdesc#1, item_sk#2, solddate#3, cnt#24]
                  :  :        +- Filter (count(1)#135 > cast(4 as bigint))
                  :  :           +- Aggregate [substr(i_item_desc#26, 1, 30), i_item_sk#27, d_date#28], [substr(i_item_desc#26, 1, 30) AS itemdesc#1, i_item_sk#27 AS item_sk#2, d_date#28 AS solddate#3, count(1) AS cnt#24, count(1) AS count(1)#135]
                  :  :              +- Filter (((ss_sold_date_sk#29 = d_date_sk#21) AND (ss_item_sk#30 = i_item_sk#27)) AND d_year#18 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
                  :  :                 +- Join Inner
                  :  :                    :- Join Inner
                  :  :                    :  :- SubqueryAlias spark_catalog.default.store_sales
                  :  :                    :  :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
                  :  :                    :  +- SubqueryAlias spark_catalog.default.date_dim
                  :  :                    :     +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
                  :  :                    +- SubqueryAlias spark_catalog.default.item
                  :  :                       +- Relation[i_item_sk#27,i_item_id#72,i_rec_start_date#73,i_rec_end_date#74,i_item_desc#26,i_current_price#75,i_wholesale_cost#76,i_brand_id#77,i_brand#78,i_class_id#79,i_class#80,i_category_id#81,i_category#82,i_manufact_id#83,i_manufact#84,i_size#85,i_formulation#86,i_color#87,i_units#88,i_container#89,i_manager_id#90,i_product_name#91] parquet
                  :  +- Project [c_customer_sk#92]
                  :     +- SubqueryAlias best_ss_customer
                  :        +- Project [c_customer_sk#92, ssales#8]
                  :           +- Filter (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136 as decimal(38,8)) > cast(CheckOverflow((promote_precision(cast(CheckOverflow((promote_precision(cast(cast(50 as decimal(2,0)) as decimal(4,1))) / promote_precision(cast(100.0 as decimal(4,1)))), DecimalType(9,6), true) as decimal(32,6))) * promote_precision(cast(scalar-subquery#7 [] as decimal(32,6)))), DecimalType(38,8), true) as decimal(38,8)))
                  :              :  +- Project [tpcds_cmax#5]
                  :              :     +- SubqueryAlias max_store_sales
                  :              :        +- Aggregate [max(csales#6) AS tpcds_cmax#5]
                  :              :           +- SubqueryAlias x
                  :              :              +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS csales#6]
                  :              :                 +- Filter (((ss_customer_sk#32 = c_customer_sk#92) AND (ss_sold_date_sk#29 = d_date_sk#21)) AND d_year#18 IN (2000,(2000 + 1),(2000 + 2),(2000 + 3)))
                  :              :                    +- Join Inner
                  :              :                       :- Join Inner
                  :              :                       :  :- SubqueryAlias spark_catalog.default.store_sales
                  :              :                       :  :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
                  :              :                       :  +- SubqueryAlias spark_catalog.default.customer
                  :              :                       :     +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
                  :              :                       +- SubqueryAlias spark_catalog.default.date_dim
                  :              :                          +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
                  :              +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS ssales#8, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136]
                  :                 +- Filter (ss_customer_sk#32 = c_customer_sk#92)
                  :                    +- Join Inner
                  :                       :- SubqueryAlias spark_catalog.default.store_sales
                  :                       :  +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
                  :                       +- SubqueryAlias spark_catalog.default.customer
                  :                          +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
                  +- Join Inner
                     :- SubqueryAlias spark_catalog.default.web_sales
                     :  +- Relation[ws_sold_date_sk#132,ws_sold_time_sk#137,ws_ship_date_sk#138,ws_item_sk#133,ws_bill_customer_sk#134,ws_bill_cdemo_sk#139,ws_bill_hdemo_sk#140,ws_bill_addr_sk#141,ws_ship_customer_sk#142,ws_ship_cdemo_sk#143,ws_ship_hdemo_sk#144,ws_ship_addr_sk#145,ws_web_page_sk#146,ws_web_site_sk#147,ws_ship_mode_sk#148,ws_warehouse_sk#149,ws_promo_sk#150,ws_order_number#151,ws_quantity#130,ws_wholesale_cost#152,ws_list_price#131,ws_sales_price#153,ws_ext_discount_amt#154,ws_ext_sales_price#155,... 10 more fields] parquet
                     +- SubqueryAlias spark_catalog.default.date_dim
                        +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet

== Optimized Logical Plan ==
GlobalLimit 100
+- LocalLimit 100
   +- Aggregate [sum(sales#9) AS sum(sales)#15]
      +- Union false, false
         :- Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#16 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#17 as decimal(12,2)))), DecimalType(18,2), true) AS sales#9]
         :  +- Join Inner, (cs_sold_date_sk#20 = d_date_sk#21)
         :     :- Project [cs_sold_date_sk#20, cs_quantity#16, cs_list_price#17]
         :     :  +- Join LeftSemi, (cs_bill_customer_sk#23 = c_customer_sk#92)
         :     :     :- Project [cs_sold_date_sk#20, cs_bill_customer_sk#23, cs_quantity#16, cs_list_price#17]
         :     :     :  +- Join LeftSemi, (cs_item_sk#22 = item_sk#2)
         :     :     :     :- Project [cs_sold_date_sk#20, cs_bill_customer_sk#23, cs_item_sk#22, cs_quantity#16, cs_list_price#17]
         :     :     :     :  +- Filter isnotnull(cs_sold_date_sk#20)
         :     :     :     :     +- Relation[cs_sold_date_sk#20,cs_sold_time_sk#111,cs_ship_date_sk#112,cs_bill_customer_sk#23,cs_bill_cdemo_sk#113,cs_bill_hdemo_sk#114,cs_bill_addr_sk#115,cs_ship_customer_sk#116,cs_ship_cdemo_sk#117,cs_ship_hdemo_sk#118,cs_ship_addr_sk#119,cs_call_center_sk#120,cs_catalog_page_sk#121,cs_ship_mode_sk#122,cs_warehouse_sk#123,cs_item_sk#22,cs_promo_sk#124,cs_order_number#125,cs_quantity#16,cs_wholesale_cost#126,cs_list_price#17,cs_sales_price#127,cs_ext_discount_amt#128,cs_ext_sales_price#129,... 10 more fields] parquet
         :     :     :     +- Project [item_sk#2]
         :     :     :        +- Filter (count(1)#25 > 4)
         :     :     :           +- Aggregate [substr(i_item_desc#26, 1, 30), i_item_sk#27, d_date#28], [i_item_sk#27 AS item_sk#2, count(1) AS count(1)#25]
         :     :     :              +- Project [d_date#28, i_item_sk#27, i_item_desc#26]
         :     :     :                 +- Join Inner, (ss_item_sk#30 = i_item_sk#27)
         :     :     :                    :- Project [ss_item_sk#30, d_date#28]
         :     :     :                    :  +- Join Inner, (ss_sold_date_sk#29 = d_date_sk#21)
         :     :     :                    :     :- Project [ss_sold_date_sk#29, ss_item_sk#30]
         :     :     :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#29) AND isnotnull(ss_item_sk#30))
         :     :     :                    :     :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
         :     :     :                    :     +- Project [d_date_sk#21, d_date#28]
         :     :     :                    :        +- Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
         :     :     :                    :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
         :     :     :                    +- Project [i_item_sk#27, i_item_desc#26]
         :     :     :                       +- Filter isnotnull(i_item_sk#27)
         :     :     :                          +- Relation[i_item_sk#27,i_item_id#72,i_rec_start_date#73,i_rec_end_date#74,i_item_desc#26,i_current_price#75,i_wholesale_cost#76,i_brand_id#77,i_brand#78,i_class_id#79,i_class#80,i_category_id#81,i_category#82,i_manufact_id#83,i_manufact#84,i_size#85,i_formulation#86,i_color#87,i_units#88,i_container#89,i_manager_id#90,i_product_name#91] parquet
         :     :     +- Project [c_customer_sk#92]
         :     :        +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93) AND (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93 as decimal(38,8)) > CheckOverflow((0.500000 * promote_precision(cast(scalar-subquery#7 [] as decimal(32,6)))), DecimalType(38,8), true)))
         :     :           :  +- Aggregate [max(csales#6) AS tpcds_cmax#5]
         :     :           :     +- Aggregate [c_customer_sk#92], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS csales#6]
         :     :           :        +- Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
         :     :           :           +- Join Inner, (ss_customer_sk#32 = c_customer_sk#92)
         :     :           :              :- Project [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
         :     :           :              :  +- Join Inner, (ss_sold_date_sk#29 = d_date_sk#21)
         :     :           :              :     :- Project [ss_sold_date_sk#29, ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
         :     :           :              :     :  +- Filter (isnotnull(ss_customer_sk#32) AND isnotnull(ss_sold_date_sk#29))
         :     :           :              :     :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
         :     :           :              :     +- Project [d_date_sk#21]
         :     :           :              :        +- Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
         :     :           :              :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
         :     :           :              +- Project [c_customer_sk#92]
         :     :           :                 +- Filter isnotnull(c_customer_sk#92)
         :     :           :                    +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
         :     :           +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93]
         :     :              +- Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
         :     :                 +- Join Inner, (ss_customer_sk#32 = c_customer_sk#92)
         :     :                    :- Project [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
         :     :                    :  +- Filter isnotnull(ss_customer_sk#32)
         :     :                    :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
         :     :                    +- Project [c_customer_sk#92]
         :     :                       +- Filter isnotnull(c_customer_sk#92)
         :     :                          +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
         :     +- Project [d_date_sk#21]
         :        +- Filter ((((isnotnull(d_year#18) AND isnotnull(d_moy#19)) AND (d_year#18 = 2000)) AND (d_moy#19 = 2)) AND isnotnull(d_date_sk#21))
         :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
         +- Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#130 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#131 as decimal(12,2)))), DecimalType(18,2), true) AS sales#12]
            +- Join Inner, (ws_sold_date_sk#132 = d_date_sk#21)
               :- Project [ws_sold_date_sk#132, ws_quantity#130, ws_list_price#131]
               :  +- Join LeftSemi, (ws_bill_customer_sk#134 = c_customer_sk#92)
               :     :- Project [ws_sold_date_sk#132, ws_bill_customer_sk#134, ws_quantity#130, ws_list_price#131]
               :     :  +- Join LeftSemi, (ws_item_sk#133 = item_sk#2)
               :     :     :- Project [ws_sold_date_sk#132, ws_item_sk#133, ws_bill_customer_sk#134, ws_quantity#130, ws_list_price#131]
               :     :     :  +- Filter isnotnull(ws_sold_date_sk#132)
               :     :     :     +- Relation[ws_sold_date_sk#132,ws_sold_time_sk#137,ws_ship_date_sk#138,ws_item_sk#133,ws_bill_customer_sk#134,ws_bill_cdemo_sk#139,ws_bill_hdemo_sk#140,ws_bill_addr_sk#141,ws_ship_customer_sk#142,ws_ship_cdemo_sk#143,ws_ship_hdemo_sk#144,ws_ship_addr_sk#145,ws_web_page_sk#146,ws_web_site_sk#147,ws_ship_mode_sk#148,ws_warehouse_sk#149,ws_promo_sk#150,ws_order_number#151,ws_quantity#130,ws_wholesale_cost#152,ws_list_price#131,ws_sales_price#153,ws_ext_discount_amt#154,ws_ext_sales_price#155,... 10 more fields] parquet
               :     :     +- Project [item_sk#2]
               :     :        +- Filter (count(1)#135 > 4)
               :     :           +- Aggregate [substr(i_item_desc#26, 1, 30), i_item_sk#27, d_date#28], [i_item_sk#27 AS item_sk#2, count(1) AS count(1)#135]
               :     :              +- Project [d_date#28, i_item_sk#27, i_item_desc#26]
               :     :                 +- Join Inner, (ss_item_sk#30 = i_item_sk#27)
               :     :                    :- Project [ss_item_sk#30, d_date#28]
               :     :                    :  +- Join Inner, (ss_sold_date_sk#29 = d_date_sk#21)
               :     :                    :     :- Project [ss_sold_date_sk#29, ss_item_sk#30]
               :     :                    :     :  +- Filter (isnotnull(ss_sold_date_sk#29) AND isnotnull(ss_item_sk#30))
               :     :                    :     :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
               :     :                    :     +- Project [d_date_sk#21, d_date#28]
               :     :                    :        +- Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
               :     :                    :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
               :     :                    +- Project [i_item_sk#27, i_item_desc#26]
               :     :                       +- Filter isnotnull(i_item_sk#27)
               :     :                          +- Relation[i_item_sk#27,i_item_id#72,i_rec_start_date#73,i_rec_end_date#74,i_item_desc#26,i_current_price#75,i_wholesale_cost#76,i_brand_id#77,i_brand#78,i_class_id#79,i_class#80,i_category_id#81,i_category#82,i_manufact_id#83,i_manufact#84,i_size#85,i_formulation#86,i_color#87,i_units#88,i_container#89,i_manager_id#90,i_product_name#91] parquet
               :     +- Project [c_customer_sk#92]
               :        +- Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136) AND (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136 as decimal(38,8)) > CheckOverflow((0.500000 * promote_precision(cast(scalar-subquery#7 [] as decimal(32,6)))), DecimalType(38,8), true)))
               :           :  +- Aggregate [max(csales#6) AS tpcds_cmax#5]
               :           :     +- Aggregate [c_customer_sk#92], [sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS csales#6]
               :           :        +- Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
               :           :           +- Join Inner, (ss_customer_sk#32 = c_customer_sk#92)
               :           :              :- Project [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
               :           :              :  +- Join Inner, (ss_sold_date_sk#29 = d_date_sk#21)
               :           :              :     :- Project [ss_sold_date_sk#29, ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
               :           :              :     :  +- Filter (isnotnull(ss_customer_sk#32) AND isnotnull(ss_sold_date_sk#29))
               :           :              :     :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
               :           :              :     +- Project [d_date_sk#21]
               :           :              :        +- Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
               :           :              :           +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet
               :           :              +- Project [c_customer_sk#92]
               :           :                 +- Filter isnotnull(c_customer_sk#92)
               :           :                    +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
               :           +- Aggregate [c_customer_sk#92], [c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true)) AS sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136]
               :              +- Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
               :                 +- Join Inner, (ss_customer_sk#32 = c_customer_sk#92)
               :                    :- Project [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
               :                    :  +- Filter isnotnull(ss_customer_sk#32)
               :                    :     +- Relation[ss_sold_date_sk#29,ss_sold_time_sk#31,ss_item_sk#30,ss_customer_sk#32,ss_cdemo_sk#33,ss_hdemo_sk#34,ss_addr_sk#35,ss_store_sk#36,ss_promo_sk#37,ss_ticket_number#38,ss_quantity#39,ss_wholesale_cost#40,ss_list_price#41,ss_sales_price#42,ss_ext_discount_amt#43,ss_ext_sales_price#44,ss_ext_wholesale_cost#45,ss_ext_list_price#46,ss_ext_tax#47,ss_coupon_amt#48,ss_net_paid#49,ss_net_paid_inc_tax#50,ss_net_profit#51] parquet
               :                    +- Project [c_customer_sk#92]
               :                       +- Filter isnotnull(c_customer_sk#92)
               :                          +- Relation[c_customer_sk#92,c_customer_id#94,c_current_cdemo_sk#95,c_current_hdemo_sk#96,c_current_addr_sk#97,c_first_shipto_date_sk#98,c_first_sales_date_sk#99,c_salutation#100,c_first_name#101,c_last_name#102,c_preferred_cust_flag#103,c_birth_day#104,c_birth_month#105,c_birth_year#106,c_birth_country#107,c_login#108,c_email_address#109,c_last_review_date#110] parquet
               +- Project [d_date_sk#21]
                  +- Filter ((((isnotnull(d_year#18) AND isnotnull(d_moy#19)) AND (d_year#18 = 2000)) AND (d_moy#19 = 2)) AND isnotnull(d_date_sk#21))
                     +- Relation[d_date_sk#21,d_date_id#52,d_date#28,d_month_seq#53,d_week_seq#54,d_quarter_seq#55,d_year#18,d_dow#56,d_moy#19,d_dom#57,d_qoy#58,d_fy_year#59,d_fy_quarter_seq#60,d_fy_week_seq#61,d_day_name#62,d_quarter_name#63,d_holiday#64,d_weekend#65,d_following_holiday#66,d_first_dom#67,d_last_dom#68,d_same_day_ly#69,d_same_day_lq#70,d_current_day#71,... 4 more fields] parquet

== Physical Plan ==
CollectLimit 100
+- *(38) HashAggregate(keys=[], functions=[sum(sales#9)], output=[sum(sales)#15])
   +- Exchange SinglePartition, true, [id=#156]
      +- *(37) HashAggregate(keys=[], functions=[partial_sum(sales#9)], output=[sum#157, isEmpty#158])
         +- Union
            :- *(18) Project [CheckOverflow((promote_precision(cast(cast(cs_quantity#16 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(cs_list_price#17 as decimal(12,2)))), DecimalType(18,2), true) AS sales#9]
            :  +- *(18) BroadcastHashJoin [cs_sold_date_sk#20], [d_date_sk#21], Inner, BuildRight, false
            :     :- *(18) Project [cs_sold_date_sk#20, cs_quantity#16, cs_list_price#17]
            :     :  +- SortMergeJoin [cs_bill_customer_sk#23], [c_customer_sk#92], LeftSemi
            :     :     :- *(11) Sort [cs_bill_customer_sk#23 ASC NULLS FIRST], false, 0
            :     :     :  +- Exchange hashpartitioning(cs_bill_customer_sk#23, 5), true, [id=#159]
            :     :     :     +- *(10) Project [cs_sold_date_sk#20, cs_bill_customer_sk#23, cs_quantity#16, cs_list_price#17]
            :     :     :        +- SortMergeJoin [cs_item_sk#22], [item_sk#2], LeftSemi
            :     :     :           :- *(2) Sort [cs_item_sk#22 ASC NULLS FIRST], false, 0
            :     :     :           :  +- Exchange hashpartitioning(cs_item_sk#22, 5), true, [id=#160]
            :     :     :           :     +- *(1) Filter isnotnull(cs_sold_date_sk#20)
            :     :     :           :        +- *(1) ColumnarToRow
            :     :     :           :           +- FileScan parquet default.catalog_sales[cs_sold_date_sk#20,cs_bill_customer_sk#23,cs_item_sk#22,cs_quantity#16,cs_list_price#17] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#20)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_bill_customer_sk:int,cs_item_sk:int,cs_quantity:int,cs_list_price:d...
            :     :     :           +- *(9) Sort [item_sk#2 ASC NULLS FIRST], false, 0
            :     :     :              +- Exchange hashpartitioning(item_sk#2, 5), true, [id=#161]
            :     :     :                 +- *(8) Project [item_sk#2]
            :     :     :                    +- *(8) Filter (count(1)#25 > 4)
            :     :     :                       +- *(8) HashAggregate(keys=[substr(i_item_desc#26, 1, 30)#162, i_item_sk#27, d_date#28], functions=[count(1)], output=[item_sk#2, count(1)#25])
            :     :     :                          +- *(8) HashAggregate(keys=[substr(i_item_desc#26, 1, 30) AS substr(i_item_desc#26, 1, 30)#162, i_item_sk#27, d_date#28], functions=[partial_count(1)], output=[substr(i_item_desc#26, 1, 30)#162, i_item_sk#27, d_date#28, count#163])
            :     :     :                             +- *(8) Project [d_date#28, i_item_sk#27, i_item_desc#26]
            :     :     :                                +- *(8) SortMergeJoin [ss_item_sk#30], [i_item_sk#27], Inner
            :     :     :                                   :- *(5) Sort [ss_item_sk#30 ASC NULLS FIRST], false, 0
            :     :     :                                   :  +- Exchange hashpartitioning(ss_item_sk#30, 5), true, [id=#164]
            :     :     :                                   :     +- *(4) Project [ss_item_sk#30, d_date#28]
            :     :     :                                   :        +- *(4) BroadcastHashJoin [ss_sold_date_sk#29], [d_date_sk#21], Inner, BuildRight, false
            :     :     :                                   :           :- *(4) Filter (isnotnull(ss_sold_date_sk#29) AND isnotnull(ss_item_sk#30))
            :     :     :                                   :           :  +- *(4) ColumnarToRow
            :     :     :                                   :           :     +- FileScan parquet default.store_sales[ss_sold_date_sk#29,ss_item_sk#30] Batched: true, DataFilters: [isnotnull(ss_sold_date_sk#29), isnotnull(ss_item_sk#30)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(ss_sold_date_sk), IsNotNull(ss_item_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_item_sk:int>
            :     :     :                                   :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#165]
            :     :     :                                   :              +- *(3) Project [d_date_sk#21, d_date#28]
            :     :     :                                   :                 +- *(3) Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
            :     :     :                                   :                    +- *(3) ColumnarToRow
            :     :     :                                   :                       +- FileScan parquet default.date_dim[d_date_sk#21,d_date#28,d_year#18] Batched: true, DataFilters: [d_year#18 IN (2000,2001,2002,2003), isnotnull(d_date_sk#21)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_date:date,d_year:int>
            :     :     :                                   +- *(7) Sort [i_item_sk#27 ASC NULLS FIRST], false, 0
            :     :     :                                      +- Exchange hashpartitioning(i_item_sk#27, 5), true, [id=#166]
            :     :     :                                         +- *(6) Filter isnotnull(i_item_sk#27)
            :     :     :                                            +- *(6) ColumnarToRow
            :     :     :                                               +- FileScan parquet default.item[i_item_sk#27,i_item_desc#26] Batched: true, DataFilters: [isnotnull(i_item_sk#27)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(i_item_sk)], ReadSchema: struct<i_item_sk:int,i_item_desc:string>
            :     :     +- *(16) Sort [c_customer_sk#92 ASC NULLS FIRST], false, 0
            :     :        +- *(16) Project [c_customer_sk#92]
            :     :           +- *(16) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93) AND (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93 as decimal(38,8)) > CheckOverflow((0.500000 * promote_precision(cast(Subquery scalar-subquery#7, [id=#167] as decimal(32,6)))), DecimalType(38,8), true)))
            :     :              :  +- Subquery scalar-subquery#7, [id=#167]
            :     :              :     +- *(7) HashAggregate(keys=[], functions=[max(csales#6)], output=[tpcds_cmax#5])
            :     :              :        +- Exchange SinglePartition, true, [id=#168]
            :     :              :           +- *(6) HashAggregate(keys=[], functions=[partial_max(csales#6)], output=[max#169])
            :     :              :              +- *(6) HashAggregate(keys=[c_customer_sk#92], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[csales#6])
            :     :              :                 +- *(6) HashAggregate(keys=[c_customer_sk#92], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[c_customer_sk#92, sum#170, isEmpty#171])
            :     :              :                    +- *(6) Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
            :     :              :                       +- *(6) SortMergeJoin [ss_customer_sk#32], [c_customer_sk#92], Inner
            :     :              :                          :- *(3) Sort [ss_customer_sk#32 ASC NULLS FIRST], false, 0
            :     :              :                          :  +- Exchange hashpartitioning(ss_customer_sk#32, 5), true, [id=#172]
            :     :              :                          :     +- *(2) Project [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42]
            :     :              :                          :        +- *(2) BroadcastHashJoin [ss_sold_date_sk#29], [d_date_sk#21], Inner, BuildRight, false
            :     :              :                          :           :- *(2) Filter (isnotnull(ss_customer_sk#32) AND isnotnull(ss_sold_date_sk#29))
            :     :              :                          :           :  +- *(2) ColumnarToRow
            :     :              :                          :           :     +- FileScan parquet default.store_sales[ss_sold_date_sk#29,ss_customer_sk#32,ss_quantity#39,ss_sales_price#42] Batched: true, DataFilters: [isnotnull(ss_customer_sk#32), isnotnull(ss_sold_date_sk#29)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk), IsNotNull(ss_sold_date_sk)], ReadSchema: struct<ss_sold_date_sk:int,ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>
            :     :              :                          :           +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#173]
            :     :              :                          :              +- *(1) Project [d_date_sk#21]
            :     :              :                          :                 +- *(1) Filter (d_year#18 IN (2000,2001,2002,2003) AND isnotnull(d_date_sk#21))
            :     :              :                          :                    +- *(1) ColumnarToRow
            :     :              :                          :                       +- FileScan parquet default.date_dim[d_date_sk#21,d_year#18] Batched: true, DataFilters: [d_year#18 IN (2000,2001,2002,2003), isnotnull(d_date_sk#21)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [In(d_year, [2000,2001,2002,2003]), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int>
            :     :              :                          +- *(5) Sort [c_customer_sk#92 ASC NULLS FIRST], false, 0
            :     :              :                             +- Exchange hashpartitioning(c_customer_sk#92, 5), true, [id=#174]
            :     :              :                                +- *(4) Filter isnotnull(c_customer_sk#92)
            :     :              :                                   +- *(4) ColumnarToRow
            :     :              :                                      +- FileScan parquet default.customer[c_customer_sk#92] Batched: true, DataFilters: [isnotnull(c_customer_sk#92)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>
            :     :              +- *(16) HashAggregate(keys=[c_customer_sk#92], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#93])
            :     :                 +- *(16) HashAggregate(keys=[c_customer_sk#92], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[c_customer_sk#92, sum#175, isEmpty#176])
            :     :                    +- *(16) Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
            :     :                       +- *(16) SortMergeJoin [ss_customer_sk#32], [c_customer_sk#92], Inner
            :     :                          :- *(13) Sort [ss_customer_sk#32 ASC NULLS FIRST], false, 0
            :     :                          :  +- Exchange hashpartitioning(ss_customer_sk#32, 5), true, [id=#177]
            :     :                          :     +- *(12) Filter isnotnull(ss_customer_sk#32)
            :     :                          :        +- *(12) ColumnarToRow
            :     :                          :           +- FileScan parquet default.store_sales[ss_customer_sk#32,ss_quantity#39,ss_sales_price#42] Batched: true, DataFilters: [isnotnull(ss_customer_sk#32)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(ss_customer_sk)], ReadSchema: struct<ss_customer_sk:int,ss_quantity:int,ss_sales_price:decimal(7,2)>
            :     :                          +- *(15) Sort [c_customer_sk#92 ASC NULLS FIRST], false, 0
            :     :                             +- Exchange hashpartitioning(c_customer_sk#92, 5), true, [id=#178]
            :     :                                +- *(14) Filter isnotnull(c_customer_sk#92)
            :     :                                   +- *(14) ColumnarToRow
            :     :                                      +- FileScan parquet default.customer[c_customer_sk#92] Batched: true, DataFilters: [isnotnull(c_customer_sk#92)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(c_customer_sk)], ReadSchema: struct<c_customer_sk:int>
            :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#179]
            :        +- *(17) Project [d_date_sk#21]
            :           +- *(17) Filter ((((isnotnull(d_year#18) AND isnotnull(d_moy#19)) AND (d_year#18 = 2000)) AND (d_moy#19 = 2)) AND isnotnull(d_date_sk#21))
            :              +- *(17) ColumnarToRow
            :                 +- FileScan parquet default.date_dim[d_date_sk#21,d_year#18,d_moy#19] Batched: true, DataFilters: [isnotnull(d_year#18), isnotnull(d_moy#19), (d_year#18 = 2000), (d_moy#19 = 2), isnotnull..., Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), IsNotNull(d_moy), EqualTo(d_year,2000), EqualTo(d_moy,2), IsNotNull(d_date_sk)], ReadSchema: struct<d_date_sk:int,d_year:int,d_moy:int>
            +- *(36) Project [CheckOverflow((promote_precision(cast(cast(ws_quantity#130 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ws_list_price#131 as decimal(12,2)))), DecimalType(18,2), true) AS sales#12]
               +- *(36) BroadcastHashJoin [ws_sold_date_sk#132], [d_date_sk#21], Inner, BuildRight, false
                  :- *(36) Project [ws_sold_date_sk#132, ws_quantity#130, ws_list_price#131]
                  :  +- SortMergeJoin [ws_bill_customer_sk#134], [c_customer_sk#92], LeftSemi
                  :     :- *(29) Sort [ws_bill_customer_sk#134 ASC NULLS FIRST], false, 0
                  :     :  +- Exchange hashpartitioning(ws_bill_customer_sk#134, 5), true, [id=#180]
                  :     :     +- *(28) Project [ws_sold_date_sk#132, ws_bill_customer_sk#134, ws_quantity#130, ws_list_price#131]
                  :     :        +- SortMergeJoin [ws_item_sk#133], [item_sk#2], LeftSemi
                  :     :           :- *(20) Sort [ws_item_sk#133 ASC NULLS FIRST], false, 0
                  :     :           :  +- Exchange hashpartitioning(ws_item_sk#133, 5), true, [id=#181]
                  :     :           :     +- *(19) Filter isnotnull(ws_sold_date_sk#132)
                  :     :           :        +- *(19) ColumnarToRow
                  :     :           :           +- FileScan parquet default.web_sales[ws_sold_date_sk#132,ws_item_sk#133,ws_bill_customer_sk#134,ws_quantity#130,ws_list_price#131] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#132)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_item_sk:int,ws_bill_customer_sk:int,ws_quantity:int,ws_list_price:d...
                  :     :           +- *(27) Sort [item_sk#2 ASC NULLS FIRST], false, 0
                  :     :              +- ReusedExchange [item_sk#2], Exchange hashpartitioning(item_sk#2, 5), true, [id=#161]
                  :     +- *(34) Sort [c_customer_sk#92 ASC NULLS FIRST], false, 0
                  :        +- *(34) Project [c_customer_sk#92]
                  :           +- *(34) Filter (isnotnull(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136) AND (cast(sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136 as decimal(38,8)) > CheckOverflow((0.500000 * promote_precision(cast(ReusedSubquery Subquery scalar-subquery#7, [id=#167] as decimal(32,6)))), DecimalType(38,8), true)))
                  :              :  +- ReusedSubquery Subquery scalar-subquery#7, [id=#167]
                  :              +- *(34) HashAggregate(keys=[c_customer_sk#92], functions=[sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[c_customer_sk#92, sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))#136])
                  :                 +- *(34) HashAggregate(keys=[c_customer_sk#92], functions=[partial_sum(CheckOverflow((promote_precision(cast(cast(ss_quantity#39 as decimal(10,0)) as decimal(12,2))) * promote_precision(cast(ss_sales_price#42 as decimal(12,2)))), DecimalType(18,2), true))], output=[c_customer_sk#92, sum#182, isEmpty#183])
                  :                    +- *(34) Project [ss_quantity#39, ss_sales_price#42, c_customer_sk#92]
                  :                       +- *(34) SortMergeJoin [ss_customer_sk#32], [c_customer_sk#92], Inner
                  :                          :- *(31) Sort [ss_customer_sk#32 ASC NULLS FIRST], false, 0
                  :                          :  +- ReusedExchange [ss_customer_sk#32, ss_quantity#39, ss_sales_price#42], Exchange hashpartitioning(ss_customer_sk#32, 5), true, [id=#177]
                  :                          +- *(33) Sort [c_customer_sk#92 ASC NULLS FIRST], false, 0
                  :                             +- ReusedExchange [c_customer_sk#92], Exchange hashpartitioning(c_customer_sk#92, 5), true, [id=#178]
                  +- ReusedExchange [d_date_sk#21], BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#179]
