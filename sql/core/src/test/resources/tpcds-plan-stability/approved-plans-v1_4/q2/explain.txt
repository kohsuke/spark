== Parsed Logical Plan ==
CTE [wscs, wswscs]
:  :- 'SubqueryAlias wscs
:  :  +- 'Union false, false
:  :     :- 'Project ['sold_date_sk, 'sales_price]
:  :     :  +- 'SubqueryAlias x
:  :     :     +- 'Project ['ws_sold_date_sk AS sold_date_sk#1, 'ws_ext_sales_price AS sales_price#2]
:  :     :        +- 'UnresolvedRelation [web_sales]
:  :     +- 'Project ['cs_sold_date_sk AS sold_date_sk#3, 'cs_ext_sales_price AS sales_price#4]
:  :        +- 'UnresolvedRelation [catalog_sales]
:  +- 'SubqueryAlias wswscs
:     +- 'Aggregate ['d_week_seq], ['d_week_seq, 'sum(CASE WHEN ('d_day_name = Sunday) THEN 'sales_price ELSE null END) AS sun_sales#5, 'sum(CASE WHEN ('d_day_name = Monday) THEN 'sales_price ELSE null END) AS mon_sales#6, 'sum(CASE WHEN ('d_day_name = Tuesday) THEN 'sales_price ELSE null END) AS tue_sales#7, 'sum(CASE WHEN ('d_day_name = Wednesday) THEN 'sales_price ELSE null END) AS wed_sales#8, 'sum(CASE WHEN ('d_day_name = Thursday) THEN 'sales_price ELSE null END) AS thu_sales#9, 'sum(CASE WHEN ('d_day_name = Friday) THEN 'sales_price ELSE null END) AS fri_sales#10, 'sum(CASE WHEN ('d_day_name = Saturday) THEN 'sales_price ELSE null END) AS sat_sales#11]
:        +- 'Filter ('d_date_sk = 'sold_date_sk)
:           +- 'Join Inner
:              :- 'UnresolvedRelation [wscs]
:              +- 'UnresolvedRelation [date_dim]
+- 'Sort ['d_week_seq1 ASC NULLS FIRST], true
   +- 'Project ['d_week_seq1, unresolvedalias('round(('sun_sales1 / 'sun_sales2), 2), None), unresolvedalias('round(('mon_sales1 / 'mon_sales2), 2), None), unresolvedalias('round(('tue_sales1 / 'tue_sales2), 2), None), unresolvedalias('round(('wed_sales1 / 'wed_sales2), 2), None), unresolvedalias('round(('thu_sales1 / 'thu_sales2), 2), None), unresolvedalias('round(('fri_sales1 / 'fri_sales2), 2), None), unresolvedalias('round(('sat_sales1 / 'sat_sales2), 2), None)]
      +- 'Filter ('d_week_seq1 = ('d_week_seq2 - 53))
         +- 'Join Inner
            :- 'SubqueryAlias y
            :  +- 'Project ['wswscs.d_week_seq AS d_week_seq1#12, 'sun_sales AS sun_sales1#13, 'mon_sales AS mon_sales1#14, 'tue_sales AS tue_sales1#15, 'wed_sales AS wed_sales1#16, 'thu_sales AS thu_sales1#17, 'fri_sales AS fri_sales1#18, 'sat_sales AS sat_sales1#19]
            :     +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) AND ('d_year = 2001))
            :        +- 'Join Inner
            :           :- 'UnresolvedRelation [wswscs]
            :           +- 'UnresolvedRelation [date_dim]
            +- 'SubqueryAlias z
               +- 'Project ['wswscs.d_week_seq AS d_week_seq2#20, 'sun_sales AS sun_sales2#21, 'mon_sales AS mon_sales2#22, 'tue_sales AS tue_sales2#23, 'wed_sales AS wed_sales2#24, 'thu_sales AS thu_sales2#25, 'fri_sales AS fri_sales2#26, 'sat_sales AS sat_sales2#27]
                  +- 'Filter (('date_dim.d_week_seq = 'wswscs.d_week_seq) AND ('d_year = (2001 + 1)))
                     +- 'Join Inner
                        :- 'UnresolvedRelation [wswscs]
                        +- 'UnresolvedRelation [date_dim]

== Analyzed Logical Plan ==
d_week_seq1: int, round((sun_sales1 / sun_sales2), 2): decimal(37,2), round((mon_sales1 / mon_sales2), 2): decimal(37,2), round((tue_sales1 / tue_sales2), 2): decimal(37,2), round((wed_sales1 / wed_sales2), 2): decimal(37,2), round((thu_sales1 / thu_sales2), 2): decimal(37,2), round((fri_sales1 / fri_sales2), 2): decimal(37,2), round((sat_sales1 / sat_sales2), 2): decimal(37,2)
Sort [d_week_seq1#12 ASC NULLS FIRST], true
+- Project [d_week_seq1#12, round(CheckOverflow((promote_precision(cast(sun_sales1#13 as decimal(17,2))) / promote_precision(cast(sun_sales2#21 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((sun_sales1 / sun_sales2), 2)#28, round(CheckOverflow((promote_precision(cast(mon_sales1#14 as decimal(17,2))) / promote_precision(cast(mon_sales2#22 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((mon_sales1 / mon_sales2), 2)#29, round(CheckOverflow((promote_precision(cast(tue_sales1#15 as decimal(17,2))) / promote_precision(cast(tue_sales2#23 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((tue_sales1 / tue_sales2), 2)#30, round(CheckOverflow((promote_precision(cast(wed_sales1#16 as decimal(17,2))) / promote_precision(cast(wed_sales2#24 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((wed_sales1 / wed_sales2), 2)#31, round(CheckOverflow((promote_precision(cast(thu_sales1#17 as decimal(17,2))) / promote_precision(cast(thu_sales2#25 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((thu_sales1 / thu_sales2), 2)#32, round(CheckOverflow((promote_precision(cast(fri_sales1#18 as decimal(17,2))) / promote_precision(cast(fri_sales2#26 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((fri_sales1 / fri_sales2), 2)#33, round(CheckOverflow((promote_precision(cast(sat_sales1#19 as decimal(17,2))) / promote_precision(cast(sat_sales2#27 as decimal(17,2)))), DecimalType(37,20), true), 2) AS round((sat_sales1 / sat_sales2), 2)#34]
   +- Filter (d_week_seq1#12 = (d_week_seq2#20 - 53))
      +- Join Inner
         :- SubqueryAlias y
         :  +- Project [d_week_seq#35 AS d_week_seq1#12, sun_sales#5 AS sun_sales1#13, mon_sales#6 AS mon_sales1#14, tue_sales#7 AS tue_sales1#15, wed_sales#8 AS wed_sales1#16, thu_sales#9 AS thu_sales1#17, fri_sales#10 AS fri_sales1#18, sat_sales#11 AS sat_sales1#19]
         :     +- Filter ((d_week_seq#36 = d_week_seq#35) AND (d_year#37 = 2001))
         :        +- Join Inner
         :           :- SubqueryAlias wswscs
         :           :  +- Aggregate [d_week_seq#35], [d_week_seq#35, sum(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS sun_sales#5, sum(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS mon_sales#6, sum(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS tue_sales#7, sum(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS wed_sales#8, sum(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS thu_sales#9, sum(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS fri_sales#10, sum(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS sat_sales#11]
         :           :     +- Filter (d_date_sk#39 = sold_date_sk#1)
         :           :        +- Join Inner
         :           :           :- SubqueryAlias wscs
         :           :           :  +- Union false, false
         :           :           :     :- Project [sold_date_sk#1, sales_price#2]
         :           :           :     :  +- SubqueryAlias x
         :           :           :     :     +- Project [ws_sold_date_sk#40 AS sold_date_sk#1, ws_ext_sales_price#41 AS sales_price#2]
         :           :           :     :        +- SubqueryAlias spark_catalog.default.web_sales
         :           :           :     :           +- Relation[ws_sold_date_sk#40,ws_sold_time_sk#42,ws_ship_date_sk#43,ws_item_sk#44,ws_bill_customer_sk#45,ws_bill_cdemo_sk#46,ws_bill_hdemo_sk#47,ws_bill_addr_sk#48,ws_ship_customer_sk#49,ws_ship_cdemo_sk#50,ws_ship_hdemo_sk#51,ws_ship_addr_sk#52,ws_web_page_sk#53,ws_web_site_sk#54,ws_ship_mode_sk#55,ws_warehouse_sk#56,ws_promo_sk#57,ws_order_number#58,ws_quantity#59,ws_wholesale_cost#60,ws_list_price#61,ws_sales_price#62,ws_ext_discount_amt#63,ws_ext_sales_price#41,... 10 more fields] parquet
         :           :           :     +- Project [cs_sold_date_sk#64 AS sold_date_sk#3, cs_ext_sales_price#65 AS sales_price#4]
         :           :           :        +- SubqueryAlias spark_catalog.default.catalog_sales
         :           :           :           +- Relation[cs_sold_date_sk#64,cs_sold_time_sk#66,cs_ship_date_sk#67,cs_bill_customer_sk#68,cs_bill_cdemo_sk#69,cs_bill_hdemo_sk#70,cs_bill_addr_sk#71,cs_ship_customer_sk#72,cs_ship_cdemo_sk#73,cs_ship_hdemo_sk#74,cs_ship_addr_sk#75,cs_call_center_sk#76,cs_catalog_page_sk#77,cs_ship_mode_sk#78,cs_warehouse_sk#79,cs_item_sk#80,cs_promo_sk#81,cs_order_number#82,cs_quantity#83,cs_wholesale_cost#84,cs_list_price#85,cs_sales_price#86,cs_ext_discount_amt#87,cs_ext_sales_price#65,... 10 more fields] parquet
         :           :           +- SubqueryAlias spark_catalog.default.date_dim
         :           :              +- Relation[d_date_sk#39,d_date_id#88,d_date#89,d_month_seq#90,d_week_seq#35,d_quarter_seq#91,d_year#92,d_dow#93,d_moy#94,d_dom#95,d_qoy#96,d_fy_year#97,d_fy_quarter_seq#98,d_fy_week_seq#99,d_day_name#38,d_quarter_name#100,d_holiday#101,d_weekend#102,d_following_holiday#103,d_first_dom#104,d_last_dom#105,d_same_day_ly#106,d_same_day_lq#107,d_current_day#108,... 4 more fields] parquet
         :           +- SubqueryAlias spark_catalog.default.date_dim
         :              +- Relation[d_date_sk#109,d_date_id#110,d_date#111,d_month_seq#112,d_week_seq#36,d_quarter_seq#113,d_year#37,d_dow#114,d_moy#115,d_dom#116,d_qoy#117,d_fy_year#118,d_fy_quarter_seq#119,d_fy_week_seq#120,d_day_name#121,d_quarter_name#122,d_holiday#123,d_weekend#124,d_following_holiday#125,d_first_dom#126,d_last_dom#127,d_same_day_ly#128,d_same_day_lq#129,d_current_day#130,... 4 more fields] parquet
         +- SubqueryAlias z
            +- Project [d_week_seq#35 AS d_week_seq2#20, sun_sales#5 AS sun_sales2#21, mon_sales#6 AS mon_sales2#22, tue_sales#7 AS tue_sales2#23, wed_sales#8 AS wed_sales2#24, thu_sales#9 AS thu_sales2#25, fri_sales#10 AS fri_sales2#26, sat_sales#11 AS sat_sales2#27]
               +- Filter ((d_week_seq#131 = d_week_seq#35) AND (d_year#132 = (2001 + 1)))
                  +- Join Inner
                     :- SubqueryAlias wswscs
                     :  +- Aggregate [d_week_seq#35], [d_week_seq#35, sum(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS sun_sales#5, sum(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS mon_sales#6, sum(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS tue_sales#7, sum(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS wed_sales#8, sum(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS thu_sales#9, sum(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS fri_sales#10, sum(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE cast(null as decimal(7,2)) END) AS sat_sales#11]
                     :     +- Filter (d_date_sk#39 = sold_date_sk#1)
                     :        +- Join Inner
                     :           :- SubqueryAlias wscs
                     :           :  +- Union false, false
                     :           :     :- Project [sold_date_sk#1, sales_price#2]
                     :           :     :  +- SubqueryAlias x
                     :           :     :     +- Project [ws_sold_date_sk#40 AS sold_date_sk#1, ws_ext_sales_price#41 AS sales_price#2]
                     :           :     :        +- SubqueryAlias spark_catalog.default.web_sales
                     :           :     :           +- Relation[ws_sold_date_sk#40,ws_sold_time_sk#42,ws_ship_date_sk#43,ws_item_sk#44,ws_bill_customer_sk#45,ws_bill_cdemo_sk#46,ws_bill_hdemo_sk#47,ws_bill_addr_sk#48,ws_ship_customer_sk#49,ws_ship_cdemo_sk#50,ws_ship_hdemo_sk#51,ws_ship_addr_sk#52,ws_web_page_sk#53,ws_web_site_sk#54,ws_ship_mode_sk#55,ws_warehouse_sk#56,ws_promo_sk#57,ws_order_number#58,ws_quantity#59,ws_wholesale_cost#60,ws_list_price#61,ws_sales_price#62,ws_ext_discount_amt#63,ws_ext_sales_price#41,... 10 more fields] parquet
                     :           :     +- Project [cs_sold_date_sk#64 AS sold_date_sk#3, cs_ext_sales_price#65 AS sales_price#4]
                     :           :        +- SubqueryAlias spark_catalog.default.catalog_sales
                     :           :           +- Relation[cs_sold_date_sk#64,cs_sold_time_sk#66,cs_ship_date_sk#67,cs_bill_customer_sk#68,cs_bill_cdemo_sk#69,cs_bill_hdemo_sk#70,cs_bill_addr_sk#71,cs_ship_customer_sk#72,cs_ship_cdemo_sk#73,cs_ship_hdemo_sk#74,cs_ship_addr_sk#75,cs_call_center_sk#76,cs_catalog_page_sk#77,cs_ship_mode_sk#78,cs_warehouse_sk#79,cs_item_sk#80,cs_promo_sk#81,cs_order_number#82,cs_quantity#83,cs_wholesale_cost#84,cs_list_price#85,cs_sales_price#86,cs_ext_discount_amt#87,cs_ext_sales_price#65,... 10 more fields] parquet
                     :           +- SubqueryAlias spark_catalog.default.date_dim
                     :              +- Relation[d_date_sk#39,d_date_id#88,d_date#89,d_month_seq#90,d_week_seq#35,d_quarter_seq#91,d_year#92,d_dow#93,d_moy#94,d_dom#95,d_qoy#96,d_fy_year#97,d_fy_quarter_seq#98,d_fy_week_seq#99,d_day_name#38,d_quarter_name#100,d_holiday#101,d_weekend#102,d_following_holiday#103,d_first_dom#104,d_last_dom#105,d_same_day_ly#106,d_same_day_lq#107,d_current_day#108,... 4 more fields] parquet
                     +- SubqueryAlias spark_catalog.default.date_dim
                        +- Relation[d_date_sk#133,d_date_id#134,d_date#135,d_month_seq#136,d_week_seq#131,d_quarter_seq#137,d_year#132,d_dow#138,d_moy#139,d_dom#140,d_qoy#141,d_fy_year#142,d_fy_quarter_seq#143,d_fy_week_seq#144,d_day_name#145,d_quarter_name#146,d_holiday#147,d_weekend#148,d_following_holiday#149,d_first_dom#150,d_last_dom#151,d_same_day_ly#152,d_same_day_lq#153,d_current_day#154,... 4 more fields] parquet

== Optimized Logical Plan ==
Sort [d_week_seq1#12 ASC NULLS FIRST], true
+- Project [d_week_seq1#12, round(CheckOverflow((promote_precision(sun_sales1#13) / promote_precision(sun_sales2#21)), DecimalType(37,20), true), 2) AS round((sun_sales1 / sun_sales2), 2)#28, round(CheckOverflow((promote_precision(mon_sales1#14) / promote_precision(mon_sales2#22)), DecimalType(37,20), true), 2) AS round((mon_sales1 / mon_sales2), 2)#29, round(CheckOverflow((promote_precision(tue_sales1#15) / promote_precision(tue_sales2#23)), DecimalType(37,20), true), 2) AS round((tue_sales1 / tue_sales2), 2)#30, round(CheckOverflow((promote_precision(wed_sales1#16) / promote_precision(wed_sales2#24)), DecimalType(37,20), true), 2) AS round((wed_sales1 / wed_sales2), 2)#31, round(CheckOverflow((promote_precision(thu_sales1#17) / promote_precision(thu_sales2#25)), DecimalType(37,20), true), 2) AS round((thu_sales1 / thu_sales2), 2)#32, round(CheckOverflow((promote_precision(fri_sales1#18) / promote_precision(fri_sales2#26)), DecimalType(37,20), true), 2) AS round((fri_sales1 / fri_sales2), 2)#33, round(CheckOverflow((promote_precision(sat_sales1#19) / promote_precision(sat_sales2#27)), DecimalType(37,20), true), 2) AS round((sat_sales1 / sat_sales2), 2)#34]
   +- Join Inner, (d_week_seq1#12 = (d_week_seq2#20 - 53))
      :- Project [d_week_seq#35 AS d_week_seq1#12, sun_sales#5 AS sun_sales1#13, mon_sales#6 AS mon_sales1#14, tue_sales#7 AS tue_sales1#15, wed_sales#8 AS wed_sales1#16, thu_sales#9 AS thu_sales1#17, fri_sales#10 AS fri_sales1#18, sat_sales#11 AS sat_sales1#19]
      :  +- Join Inner, (d_week_seq#36 = d_week_seq#35)
      :     :- Aggregate [d_week_seq#35], [d_week_seq#35, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE null END)),17,2) AS sun_sales#5, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE null END)),17,2) AS mon_sales#6, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE null END)),17,2) AS tue_sales#7, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE null END)),17,2) AS wed_sales#8, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE null END)),17,2) AS thu_sales#9, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE null END)),17,2) AS fri_sales#10, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE null END)),17,2) AS sat_sales#11]
      :     :  +- Project [sales_price#2, d_week_seq#35, d_day_name#38]
      :     :     +- Join Inner, (d_date_sk#39 = sold_date_sk#1)
      :     :        :- Union false, false
      :     :        :  :- Project [ws_sold_date_sk#40 AS sold_date_sk#1, ws_ext_sales_price#41 AS sales_price#2]
      :     :        :  :  +- Filter isnotnull(ws_sold_date_sk#40)
      :     :        :  :     +- Relation[ws_sold_date_sk#40,ws_sold_time_sk#42,ws_ship_date_sk#43,ws_item_sk#44,ws_bill_customer_sk#45,ws_bill_cdemo_sk#46,ws_bill_hdemo_sk#47,ws_bill_addr_sk#48,ws_ship_customer_sk#49,ws_ship_cdemo_sk#50,ws_ship_hdemo_sk#51,ws_ship_addr_sk#52,ws_web_page_sk#53,ws_web_site_sk#54,ws_ship_mode_sk#55,ws_warehouse_sk#56,ws_promo_sk#57,ws_order_number#58,ws_quantity#59,ws_wholesale_cost#60,ws_list_price#61,ws_sales_price#62,ws_ext_discount_amt#63,ws_ext_sales_price#41,... 10 more fields] parquet
      :     :        :  +- Project [cs_sold_date_sk#64 AS sold_date_sk#3, cs_ext_sales_price#65 AS sales_price#4]
      :     :        :     +- Filter isnotnull(cs_sold_date_sk#64)
      :     :        :        +- Relation[cs_sold_date_sk#64,cs_sold_time_sk#66,cs_ship_date_sk#67,cs_bill_customer_sk#68,cs_bill_cdemo_sk#69,cs_bill_hdemo_sk#70,cs_bill_addr_sk#71,cs_ship_customer_sk#72,cs_ship_cdemo_sk#73,cs_ship_hdemo_sk#74,cs_ship_addr_sk#75,cs_call_center_sk#76,cs_catalog_page_sk#77,cs_ship_mode_sk#78,cs_warehouse_sk#79,cs_item_sk#80,cs_promo_sk#81,cs_order_number#82,cs_quantity#83,cs_wholesale_cost#84,cs_list_price#85,cs_sales_price#86,cs_ext_discount_amt#87,cs_ext_sales_price#65,... 10 more fields] parquet
      :     :        +- Project [d_date_sk#39, d_week_seq#35, d_day_name#38]
      :     :           +- Filter (isnotnull(d_date_sk#39) AND isnotnull(d_week_seq#35))
      :     :              +- Relation[d_date_sk#39,d_date_id#88,d_date#89,d_month_seq#90,d_week_seq#35,d_quarter_seq#91,d_year#92,d_dow#93,d_moy#94,d_dom#95,d_qoy#96,d_fy_year#97,d_fy_quarter_seq#98,d_fy_week_seq#99,d_day_name#38,d_quarter_name#100,d_holiday#101,d_weekend#102,d_following_holiday#103,d_first_dom#104,d_last_dom#105,d_same_day_ly#106,d_same_day_lq#107,d_current_day#108,... 4 more fields] parquet
      :     +- Project [d_week_seq#36]
      :        +- Filter ((isnotnull(d_year#37) AND (d_year#37 = 2001)) AND isnotnull(d_week_seq#36))
      :           +- Relation[d_date_sk#109,d_date_id#110,d_date#111,d_month_seq#112,d_week_seq#36,d_quarter_seq#113,d_year#37,d_dow#114,d_moy#115,d_dom#116,d_qoy#117,d_fy_year#118,d_fy_quarter_seq#119,d_fy_week_seq#120,d_day_name#121,d_quarter_name#122,d_holiday#123,d_weekend#124,d_following_holiday#125,d_first_dom#126,d_last_dom#127,d_same_day_ly#128,d_same_day_lq#129,d_current_day#130,... 4 more fields] parquet
      +- Project [d_week_seq#35 AS d_week_seq2#20, sun_sales#5 AS sun_sales2#21, mon_sales#6 AS mon_sales2#22, tue_sales#7 AS tue_sales2#23, wed_sales#8 AS wed_sales2#24, thu_sales#9 AS thu_sales2#25, fri_sales#10 AS fri_sales2#26, sat_sales#11 AS sat_sales2#27]
         +- Join Inner, (d_week_seq#131 = d_week_seq#35)
            :- Aggregate [d_week_seq#35], [d_week_seq#35, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE null END)),17,2) AS sun_sales#5, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE null END)),17,2) AS mon_sales#6, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE null END)),17,2) AS tue_sales#7, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE null END)),17,2) AS wed_sales#8, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE null END)),17,2) AS thu_sales#9, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE null END)),17,2) AS fri_sales#10, MakeDecimal(sum(UnscaledValue(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE null END)),17,2) AS sat_sales#11]
            :  +- Project [sales_price#2, d_week_seq#35, d_day_name#38]
            :     +- Join Inner, (d_date_sk#39 = sold_date_sk#1)
            :        :- Union false, false
            :        :  :- Project [ws_sold_date_sk#40 AS sold_date_sk#1, ws_ext_sales_price#41 AS sales_price#2]
            :        :  :  +- Filter isnotnull(ws_sold_date_sk#40)
            :        :  :     +- Relation[ws_sold_date_sk#40,ws_sold_time_sk#42,ws_ship_date_sk#43,ws_item_sk#44,ws_bill_customer_sk#45,ws_bill_cdemo_sk#46,ws_bill_hdemo_sk#47,ws_bill_addr_sk#48,ws_ship_customer_sk#49,ws_ship_cdemo_sk#50,ws_ship_hdemo_sk#51,ws_ship_addr_sk#52,ws_web_page_sk#53,ws_web_site_sk#54,ws_ship_mode_sk#55,ws_warehouse_sk#56,ws_promo_sk#57,ws_order_number#58,ws_quantity#59,ws_wholesale_cost#60,ws_list_price#61,ws_sales_price#62,ws_ext_discount_amt#63,ws_ext_sales_price#41,... 10 more fields] parquet
            :        :  +- Project [cs_sold_date_sk#64 AS sold_date_sk#3, cs_ext_sales_price#65 AS sales_price#4]
            :        :     +- Filter isnotnull(cs_sold_date_sk#64)
            :        :        +- Relation[cs_sold_date_sk#64,cs_sold_time_sk#66,cs_ship_date_sk#67,cs_bill_customer_sk#68,cs_bill_cdemo_sk#69,cs_bill_hdemo_sk#70,cs_bill_addr_sk#71,cs_ship_customer_sk#72,cs_ship_cdemo_sk#73,cs_ship_hdemo_sk#74,cs_ship_addr_sk#75,cs_call_center_sk#76,cs_catalog_page_sk#77,cs_ship_mode_sk#78,cs_warehouse_sk#79,cs_item_sk#80,cs_promo_sk#81,cs_order_number#82,cs_quantity#83,cs_wholesale_cost#84,cs_list_price#85,cs_sales_price#86,cs_ext_discount_amt#87,cs_ext_sales_price#65,... 10 more fields] parquet
            :        +- Project [d_date_sk#39, d_week_seq#35, d_day_name#38]
            :           +- Filter (isnotnull(d_date_sk#39) AND isnotnull(d_week_seq#35))
            :              +- Relation[d_date_sk#39,d_date_id#88,d_date#89,d_month_seq#90,d_week_seq#35,d_quarter_seq#91,d_year#92,d_dow#93,d_moy#94,d_dom#95,d_qoy#96,d_fy_year#97,d_fy_quarter_seq#98,d_fy_week_seq#99,d_day_name#38,d_quarter_name#100,d_holiday#101,d_weekend#102,d_following_holiday#103,d_first_dom#104,d_last_dom#105,d_same_day_ly#106,d_same_day_lq#107,d_current_day#108,... 4 more fields] parquet
            +- Project [d_week_seq#131]
               +- Filter ((isnotnull(d_year#132) AND (d_year#132 = 2002)) AND isnotnull(d_week_seq#131))
                  +- Relation[d_date_sk#133,d_date_id#134,d_date#135,d_month_seq#136,d_week_seq#131,d_quarter_seq#137,d_year#132,d_dow#138,d_moy#139,d_dom#140,d_qoy#141,d_fy_year#142,d_fy_quarter_seq#143,d_fy_week_seq#144,d_day_name#145,d_quarter_name#146,d_holiday#147,d_weekend#148,d_following_holiday#149,d_first_dom#150,d_last_dom#151,d_same_day_ly#152,d_same_day_lq#153,d_current_day#154,... 4 more fields] parquet

== Physical Plan ==
*(13) Sort [d_week_seq1#12 ASC NULLS FIRST], true, 0
+- Exchange rangepartitioning(d_week_seq1#12 ASC NULLS FIRST, 5), true, [id=#155]
   +- *(12) Project [d_week_seq1#12, round(CheckOverflow((promote_precision(sun_sales1#13) / promote_precision(sun_sales2#21)), DecimalType(37,20), true), 2) AS round((sun_sales1 / sun_sales2), 2)#28, round(CheckOverflow((promote_precision(mon_sales1#14) / promote_precision(mon_sales2#22)), DecimalType(37,20), true), 2) AS round((mon_sales1 / mon_sales2), 2)#29, round(CheckOverflow((promote_precision(tue_sales1#15) / promote_precision(tue_sales2#23)), DecimalType(37,20), true), 2) AS round((tue_sales1 / tue_sales2), 2)#30, round(CheckOverflow((promote_precision(wed_sales1#16) / promote_precision(wed_sales2#24)), DecimalType(37,20), true), 2) AS round((wed_sales1 / wed_sales2), 2)#31, round(CheckOverflow((promote_precision(thu_sales1#17) / promote_precision(thu_sales2#25)), DecimalType(37,20), true), 2) AS round((thu_sales1 / thu_sales2), 2)#32, round(CheckOverflow((promote_precision(fri_sales1#18) / promote_precision(fri_sales2#26)), DecimalType(37,20), true), 2) AS round((fri_sales1 / fri_sales2), 2)#33, round(CheckOverflow((promote_precision(sat_sales1#19) / promote_precision(sat_sales2#27)), DecimalType(37,20), true), 2) AS round((sat_sales1 / sat_sales2), 2)#34]
      +- *(12) BroadcastHashJoin [d_week_seq1#12], [(d_week_seq2#20 - 53)], Inner, BuildRight, false
         :- *(12) Project [d_week_seq#35 AS d_week_seq1#12, sun_sales#5 AS sun_sales1#13, mon_sales#6 AS mon_sales1#14, tue_sales#7 AS tue_sales1#15, wed_sales#8 AS wed_sales1#16, thu_sales#9 AS thu_sales1#17, fri_sales#10 AS fri_sales1#18, sat_sales#11 AS sat_sales1#19]
         :  +- *(12) BroadcastHashJoin [d_week_seq#35], [d_week_seq#36], Inner, BuildRight, false
         :     :- *(12) HashAggregate(keys=[d_week_seq#35], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE null END))], output=[d_week_seq#35, sun_sales#5, mon_sales#6, tue_sales#7, wed_sales#8, thu_sales#9, fri_sales#10, sat_sales#11])
         :     :  +- Exchange hashpartitioning(d_week_seq#35, 5), true, [id=#156]
         :     :     +- *(4) HashAggregate(keys=[d_week_seq#35], functions=[partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE null END)), partial_sum(UnscaledValue(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE null END))], output=[d_week_seq#35, sum#157, sum#158, sum#159, sum#160, sum#161, sum#162, sum#163])
         :     :        +- *(4) Project [sales_price#2, d_week_seq#35, d_day_name#38]
         :     :           +- *(4) BroadcastHashJoin [sold_date_sk#1], [d_date_sk#39], Inner, BuildRight, false
         :     :              :- Union
         :     :              :  :- *(1) Project [ws_sold_date_sk#40 AS sold_date_sk#1, ws_ext_sales_price#41 AS sales_price#2]
         :     :              :  :  +- *(1) Filter isnotnull(ws_sold_date_sk#40)
         :     :              :  :     +- *(1) ColumnarToRow
         :     :              :  :        +- FileScan parquet default.web_sales[ws_sold_date_sk#40,ws_ext_sales_price#41] Batched: true, DataFilters: [isnotnull(ws_sold_date_sk#40)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(ws_sold_date_sk)], ReadSchema: struct<ws_sold_date_sk:int,ws_ext_sales_price:decimal(7,2)>
         :     :              :  +- *(2) Project [cs_sold_date_sk#64 AS sold_date_sk#3, cs_ext_sales_price#65 AS sales_price#4]
         :     :              :     +- *(2) Filter isnotnull(cs_sold_date_sk#64)
         :     :              :        +- *(2) ColumnarToRow
         :     :              :           +- FileScan parquet default.catalog_sales[cs_sold_date_sk#64,cs_ext_sales_price#65] Batched: true, DataFilters: [isnotnull(cs_sold_date_sk#64)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(cs_sold_date_sk)], ReadSchema: struct<cs_sold_date_sk:int,cs_ext_sales_price:decimal(7,2)>
         :     :              +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#164]
         :     :                 +- *(3) Project [d_date_sk#39, d_week_seq#35, d_day_name#38]
         :     :                    +- *(3) Filter (isnotnull(d_date_sk#39) AND isnotnull(d_week_seq#35))
         :     :                       +- *(3) ColumnarToRow
         :     :                          +- FileScan parquet default.date_dim[d_date_sk#39,d_week_seq#35,d_day_name#38] Batched: true, DataFilters: [isnotnull(d_date_sk#39), isnotnull(d_week_seq#35)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(d_date_sk), IsNotNull(d_week_seq)], ReadSchema: struct<d_date_sk:int,d_week_seq:int,d_day_name:string>
         :     +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#165]
         :        +- *(5) Project [d_week_seq#36]
         :           +- *(5) Filter ((isnotnull(d_year#37) AND (d_year#37 = 2001)) AND isnotnull(d_week_seq#36))
         :              +- *(5) ColumnarToRow
         :                 +- FileScan parquet default.date_dim[d_week_seq#36,d_year#37] Batched: true, DataFilters: [isnotnull(d_year#37), (d_year#37 = 2001), isnotnull(d_week_seq#36)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2001), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>
         +- BroadcastExchange HashedRelationBroadcastMode(List(cast((input[0, int, true] - 53) as bigint)),false), [id=#166]
            +- *(11) Project [d_week_seq#35 AS d_week_seq2#20, sun_sales#5 AS sun_sales2#21, mon_sales#6 AS mon_sales2#22, tue_sales#7 AS tue_sales2#23, wed_sales#8 AS wed_sales2#24, thu_sales#9 AS thu_sales2#25, fri_sales#10 AS fri_sales2#26, sat_sales#11 AS sat_sales2#27]
               +- *(11) BroadcastHashJoin [d_week_seq#35], [d_week_seq#131], Inner, BuildRight, false
                  :- *(11) HashAggregate(keys=[d_week_seq#35], functions=[sum(UnscaledValue(CASE WHEN (d_day_name#38 = Sunday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Monday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Tuesday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Wednesday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Thursday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Friday) THEN sales_price#2 ELSE null END)), sum(UnscaledValue(CASE WHEN (d_day_name#38 = Saturday) THEN sales_price#2 ELSE null END))], output=[d_week_seq#35, sun_sales#5, mon_sales#6, tue_sales#7, wed_sales#8, thu_sales#9, fri_sales#10, sat_sales#11])
                  :  +- ReusedExchange [d_week_seq#35, sum#167, sum#168, sum#169, sum#170, sum#171, sum#172, sum#173], Exchange hashpartitioning(d_week_seq#35, 5), true, [id=#156]
                  +- BroadcastExchange HashedRelationBroadcastMode(List(cast(input[0, int, true] as bigint)),false), [id=#174]
                     +- *(10) Project [d_week_seq#131]
                        +- *(10) Filter ((isnotnull(d_year#132) AND (d_year#132 = 2002)) AND isnotnull(d_week_seq#131))
                           +- *(10) ColumnarToRow
                              +- FileScan parquet default.date_dim[d_week_seq#131,d_year#132] Batched: true, DataFilters: [isnotnull(d_year#132), (d_year#132 = 2002), isnotnull(d_week_seq#131)], Format: Parquet, Location: InMemoryFileIndex[file:/Users/yi.wu/IdeaProjects/spark/sql/core/spark-warehouse/org.apache.spark...., PartitionFilters: [], PushedFilters: [IsNotNull(d_year), EqualTo(d_year,2002), IsNotNull(d_week_seq)], ReadSchema: struct<d_week_seq:int,d_year:int>
